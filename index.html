<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>FraudGuard ‚Äî Anti-Scam</title>

<link rel="icon" href="./favicon.ico?v=10008">
<link rel="apple-touch-icon" href="./apple-touch-icon.png?v=10008">
<meta name="theme-color" content="#070c18">

<style>
:root{
  --bg0:#04060f;
  --bg2:#0b1220;

  --text:#eef3ff;
  --muted:#a9b7d8;
  --muted2:#7f95be;

  --line:rgba(255,255,255,.10);

  --good:#2ee59d;
  --warn:#ffcc66;
  --bad:#ff5c7a;
  --accent:#6aa6ff;

  --shadow: 0 22px 100px rgba(0,0,0,.48);
  --shadow2: 0 14px 70px rgba(0,0,0,.30);
  --r2:26px;

  --spring: cubic-bezier(.16,1,.3,1);

  --glass: rgba(255,255,255,.06);
  --glass2: rgba(255,255,255,.035);
  --stroke: rgba(255,255,255,.12);

  --tabsRad: 20px;
  --tabsPad: 8px;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
  color:var(--text);
  background: linear-gradient(180deg, var(--bg0), var(--bg2));
  overflow-x:hidden;
  letter-spacing:.1px;
}
::selection{background:rgba(106,166,255,.35)}

@media (prefers-reduced-motion: reduce){
  *{ animation:none !important; transition:none !important; }
}

/* ===== Fluid background (moving) ===== */
.fluid{
  position:fixed; inset:-8%;
  z-index:-6;
  pointer-events:none;
  opacity:.70;
  filter: blur(8px) saturate(1.15);
  transform: translateZ(0);
}
.fluid svg{ width:100%; height:100%; display:block; }
.fluid .vignette{
  position:absolute; inset:0;
  background:
    radial-gradient(900px 520px at 15% 10%, rgba(106,166,255,.18), transparent 60%),
    radial-gradient(900px 520px at 85% 12%, rgba(46,229,157,.12), transparent 62%),
    radial-gradient(1100px 760px at 45% 95%, rgba(255,92,122,.10), transparent 60%),
    radial-gradient(1200px 900px at 50% 50%, transparent 45%, rgba(0,0,0,.55) 85%),
    linear-gradient(180deg, rgba(4,6,15,.85), rgba(11,18,32,.90));
  mix-blend-mode: overlay;
  pointer-events:none;
}

/* ===== MOBILE PERF PATCH (FraudGuard) ===== */
@media (pointer: coarse), (max-width: 900px){

  /* –û—Å–ª–∞–±–ª—è–µ–º —Ç—è–∂—ë–ª—ã–π —Ñ–æ–Ω */
  .fluid{
    filter: blur(4px) saturate(1.05) !important;
    opacity: .45 !important;
  }

  /* –û—Å–ª–∞–±–ª—è–µ–º glass-—ç—Ñ—Ñ–µ–∫—Ç */
  .card{
    backdrop-filter: blur(8px) !important;
  }

  /* –£–±–∏—Ä–∞–µ–º —Ç—è–∂—ë–ª—ã–µ –ø—Å–µ–≤–¥–æ-—Å–≤–µ—á–µ–Ω–∏—è */
  .card::before,
  .card.tilt::after{
    opacity: .05 !important;
  }

  /* –£–±–∏—Ä–∞–µ–º sheen-–∞–Ω–∏–º–∞—Ü–∏–∏ */
  .tab-ind::after,
  .loading-fill::after,
  .btn::before{
    animation: none !important;
  }

  /* –£–±–∏—Ä–∞–µ–º 3D-–Ω–∞–∫–ª–æ–Ω —Ç–∞–±–æ–≤ */
  .tabs{
    transform: none !important;
  }

  /* –ß—É—Ç—å –±–æ–ª—å—à–µ —Ç–∞—á-–∑–æ–Ω—ã */
  .btn{
    min-height: 48px;
    padding: 12px 16px;
  }

  textarea,
  input{
    font-size: 16px; /* —Ñ–∏–∫—Å zoom iOS */
  }

  /* –ö–∞—Ä—Ç–æ—á–∫–∏ –≤ –∫–æ–ª–æ–Ω–∫—É */
  .grid{
    grid-template-columns: 1fr !important;
  }

  /* –ú–µ–Ω—å—à–µ –ø–∞–¥–¥–∏–Ω–≥–æ–≤ */
  .wrap{
    padding: 16px 12px 28px !important;
  }

  /* –ß—É—Ç—å –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ topbar */
  .topbar{
    padding: 6px 2px !important;
  }
}

/* subtle noise */
.noise{
  position:fixed; inset:0; z-index:-2; pointer-events:none;
  opacity:.07;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='280' height='280'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='280' height='280' filter='url(%23n)' opacity='.4'/%3E%3C/svg%3E");
  mix-blend-mode: overlay;
}

/* ===== WIDE LAYOUT ===== */
.wrap{
  max-width: 1240px;
  margin: 0 auto;
  padding: 22px 18px 44px;
  position:relative;
  z-index:1;
}

/* topbar */
.topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:14px;
  margin-bottom:16px;

  max-width:1240px;
  margin-left:auto;
  margin-right:auto;
  padding: 10px 2px;
}
.brand{ display:flex; align-items:center; gap:12px; }
.logo{
  width:44px; height:44px; border-radius:16px;
  background: linear-gradient(135deg, rgba(106,166,255,1), rgba(46,229,157,1));
  display:grid; place-items:center;
  color:#061023; font-weight:950;
  box-shadow: 0 18px 65px rgba(0,0,0,.35);
  animation: popLogo .7s var(--spring) both;
}
@keyframes popLogo{ from{transform:translateY(8px) scale(.92);opacity:0} to{transform:translateY(0) scale(1);opacity:1} }
.brand h1{ margin:0; font-size:16px; letter-spacing:.3px; line-height:1.1; }
.brand .sub{ margin-top:2px; font-size:12px; color: var(--muted2); }

.badges{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-end; }
.pill{
  display:inline-flex; align-items:center; gap:8px;
  padding:8px 12px; border-radius:999px;
  border:1px solid var(--line); background: rgba(255,255,255,.05);
  font-size:12px; backdrop-filter: blur(10px);
  animation: fadeIn .7s var(--spring) both;
}
.pill:nth-child(2){ animation-delay:.06s; }
@keyframes fadeIn{ from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:translateY(0)} }
.pill .dot{ width:8px; height:8px; border-radius:999px; background: var(--accent); box-shadow: 0 0 0 6px rgba(106,166,255,.10); }
.pill .kbd{ padding:2px 8px; border-radius:10px; border:1px solid rgba(255,255,255,.14); background: rgba(0,0,0,.25); font-size:12px; }

/* language switch */
.langSel{
  display:inline-flex; align-items:center; gap:8px;
  padding:8px 12px; border-radius:999px;
  border:1px solid var(--line); background: rgba(255,255,255,.05);
  font-size:12px; backdrop-filter: blur(10px);
}
.langSel select{
  background: transparent;
  border:0;
  color: var(--text);
  outline:none;
  cursor:pointer;
  appearance:none;
  padding-right: 2px;
}
.langSel:hover{ filter: brightness(1.05); }

/* grid */
.grid{
  display:grid;
  grid-template-columns: 1.15fr .85fr;
  gap:18px;
  align-items:start;
  max-width:1240px;
  margin: 0 auto;
}
@media (max-width: 980px){
  .grid{grid-template-columns: 1fr}
  .topbar{flex-direction:column; align-items:flex-start}
  .badges{justify-content:flex-start}
}

/* ===== Cards ===== */
.card{
  --mx: 50%;
  --my: 50%;
  border-radius: var(--r2);
  border: 1px solid var(--stroke);
  background: linear-gradient(180deg, var(--glass), var(--glass2));
  box-shadow: 0 26px 120px rgba(0,0,0,.55);
  padding: 18px;
  backdrop-filter: blur(14px);
  position:relative; overflow:hidden;
  transform-style: preserve-3d;
  transform: perspective(980px) rotateX(0deg) rotateY(0deg);
  transition: box-shadow .25s ease, transform .18s ease;
  animation: cardIn .75s var(--spring) both;
  contain: layout paint;
}
#leftCard{ animation-delay:.05s; }
#rightCard{ animation-delay:.11s; }
@keyframes cardIn{ from{opacity:0;transform:translateY(16px) scale(.985)} to{opacity:1;transform:translateY(0) scale(1)} }
.card:hover{ box-shadow: 0 34px 140px rgba(0,0,0,.62); }

.card::before{
  content:"";
  position:absolute; inset:-1px;
  pointer-events:none;
  background:
    radial-gradient(900px 260px at 18% 0%, rgba(106,166,255,.12), transparent 62%),
    radial-gradient(900px 260px at 82% 0%, rgba(46,229,157,.10), transparent 62%);
  opacity: .95;
}
.card > *{ position:relative; transform: translateZ(0.01px); }

.card.tilt::after{
  content:"";
  position:absolute; inset:-1px;
  pointer-events:none;
  border-radius: inherit;
  background: radial-gradient(520px 320px at var(--mx) var(--my),
    rgba(255,255,255,.012),
    rgba(106,166,255,.008) 25%,
    rgba(46,229,157,.006) 45%,
    transparent 66%);
  opacity:0;
  transition: opacity .18s ease;
  mix-blend-mode: screen;
}
.card.tilt:hover::after{ opacity:.10; }

.depth-1{ transform: translateZ(16px); }
.depth-2{ transform: translateZ(24px); }

.header-row{ display:flex; align-items:flex-end; justify-content:space-between; gap:12px; margin-bottom:12px; }
.title{ font-weight:950; font-size:18px; letter-spacing:.2px; }
.caption{ font-size:12.5px; color: var(--muted2); margin-top:4px; line-height:1.35; }

/* ===== Tabs (PREMIUM + FIXED ‚Äú—Å–ª–∏–ø–∞–Ω–∏–µ‚Äù) ===== */
.tabs{
  --i: 0;
  position:relative;
  display:flex;
  gap:10px;
  padding: var(--tabsPad);
  border-radius: var(--tabsRad);
  border:1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.035);
  overflow:hidden;
  transform: translateZ(24px);
  align-items:stretch;
  min-height:48px;
  box-shadow: 0 12px 50px rgba(0,0,0,.22);
  isolation:isolate;
}
.tabs::before{
  content:"";
  position:absolute; inset:0;
  pointer-events:none;
  background:
    radial-gradient(900px 240px at 18% 0%, rgba(106,166,255,.10), transparent 64%),
    radial-gradient(900px 240px at 82% 0%, rgba(46,229,157,.08), transparent 64%);
  opacity:.9;
  z-index:0;
}
.tab-ind{
  position:absolute;
  left: var(--tabsPad);
  top: var(--tabsPad);
  bottom: var(--tabsPad);
  width: calc(50% - (var(--tabsPad) * .5) - 5px);
  border-radius: calc(var(--tabsRad) - 6px);
  background: rgba(255,255,255,.10);
  border:1px solid rgba(255,255,255,.16);
  transform: translateX(calc(var(--i) * (100% + 10px)));
  transition: transform .62s var(--spring);
  box-shadow: 0 16px 40px rgba(0,0,0,.28);
  z-index:1;
  overflow:hidden;
}
.tab-ind::after{
  content:"";
  position:absolute; inset:-30% -40%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.16), transparent);
  transform: translateX(-70%) rotate(10deg);
  opacity:.8;
  animation: tabsSheen 1.25s ease-in-out infinite;
}
@keyframes tabsSheen{
  0%{ transform: translateX(-70%) rotate(10deg); opacity:.25; }
  55%{ opacity:.55; }
  100%{ transform: translateX(70%) rotate(10deg); opacity:.25; }
}
.tab{
  position:relative;
  flex:1;
  padding: 11px 12px;
  border-radius: calc(var(--tabsRad) - 6px);
  border:1px solid transparent;
  background: transparent;
  color: rgba(231,238,255,.72);
  font-size: 13px;
  font-weight: 950;
  cursor:pointer;
  white-space: nowrap;
  display:flex;
  align-items:center;
  justify-content:center;
  transition: transform .22s var(--spring), color .22s ease, filter .22s ease;
  z-index:2;
}
.tab:hover{ transform: translateY(-1px) scale(1.01); filter: brightness(1.07); }
.tab:active{ transform: translateY(0) scale(.99); }
.tab.active{
  color: var(--text);
  text-shadow: 0 10px 30px rgba(0,0,0,.35);
}

/* ‚Äú–∫–ª–∞—Å—Å–Ω–∞—è‚Äù –∞–Ω–∏–º–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ */
.modeAnim{
  position:relative;
  perspective: 1200px;
  transform-style: preserve-3d;
}

/* ‚ÄúWOW‚Äù switch: direction-aware, with depth + motion blur */
.modeAnim.swap{
  animation: modeSwap .74s var(--spring);
}
.modeAnim.swap[data-swap="toPro"]{
  --sx: 1;
}
.modeAnim.swap[data-swap="toQuick"]{
  --sx: -1;
}
@keyframes modeSwap{
  0%{
    transform: translate3d(0,0,0) rotateY(calc(var(--sx,1) * 0deg)) rotateX(0deg) scale(1);
    filter: blur(0px);
    opacity: 1;
  }
  22%{
    transform: translate3d(calc(var(--sx,1) * -10px), -6px, 0) rotateY(calc(var(--sx,1) * 10deg)) rotateX(2deg) scale(.992);
    filter: blur(1.2px);
    opacity: .98;
  }
  55%{
    transform: translate3d(calc(var(--sx,1) * 12px), 2px, 0) rotateY(calc(var(--sx,1) * -6deg)) rotateX(-1deg) scale(1.002);
    filter: blur(.5px);
    opacity: 1;
  }
  100%{
    transform: translate3d(0,0,0) rotateY(0deg) rotateX(0deg) scale(1);
    filter: blur(0px);
    opacity: 1;
  }
}

/* fixed stray keyframe fragment */


/* ===== HARD GUARANTEE: sender only in "–ü–æ–¥—Ä–æ–±–Ω–æ" ===== */
body[data-mode="quick"] #proWrap{ display:none !important; }
body[data-mode="pro"]   #proWrap{ display:block !important; }

/* pro fields */
.proWrap{
  overflow:hidden;
  max-height: 0px;
  opacity: 0;
  transform: translateY(-10px) scale(.985);
  filter: blur(8px);
  transition: max-height .62s var(--spring), opacity .40s ease, transform .62s var(--spring), filter .40s ease;
  will-change: max-height, transform, opacity, filter;
}
.proWrap.show{
  max-height: 140px;
  opacity: 1;
  transform: translateY(0) scale(1);
  filter: blur(0);
}

/* inputs */
.label{ font-size:12px; color: var(--muted2); margin: 12px 0 6px; }
input, textarea{
  width:100%;
  background: rgba(8,12,22,.72);
  border:1px solid rgba(255,255,255,.14);
  border-radius: 16px;
  padding: 12px 12px;
  color: var(--text);
  outline:none;
  transition: box-shadow .2s var(--spring), border-color .2s ease, transform .18s var(--spring), filter .18s ease;
}
textarea{ min-height: 158px; resize: vertical; line-height: 1.45; }
input::placeholder, textarea::placeholder{ color: rgba(159,177,209,.62); }
input:focus, textarea:focus{
  border-color: rgba(106,166,255,.65);
  box-shadow: 0 0 0 4px rgba(106,166,255,.12), 0 18px 55px rgba(0,0,0,.20);
  transform: translateY(-1px);
  filter: brightness(1.02);
}

/* helper row */
.helperRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-top:8px;
  color: var(--muted2);
  font-size: 12px;
}
.counter{
  display:inline-flex; align-items:center; gap:8px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.04);
}
.counter b{ color: rgba(231,238,255,.92); font-weight:950; }

/* chips */
.chips{ display:flex; gap:8px; flex-wrap:wrap; margin-top:12px; }
.chip{
  border:1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.05);
  color: rgba(231,238,255,.90);
  padding: 7px 12px;
  border-radius: 999px;
  font-size: 12px;
  cursor:pointer;
  transition: transform .18s var(--spring), box-shadow .2s ease, filter .2s ease;
}
.chip:hover{ transform: translateY(-2px) scale(1.02); box-shadow: var(--shadow2); filter: brightness(1.06); }
.chip:active{ transform: translateY(0) scale(.985); }

/* toast */
#toast{
  position:fixed;
  left: 50%;
  bottom: 18px;
  transform: translateX(-50%) translateY(14px);
  min-width: min(520px, 92vw);
  max-width: min(720px, 92vw);
  padding: 12px 14px;
  border-radius: 18px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(10,16,30,.72);
  backdrop-filter: blur(14px);
  box-shadow: 0 22px 90px rgba(0,0,0,.55);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  opacity:0;
  pointer-events:none;
  transition: opacity .22s ease, transform .32s var(--spring);
  z-index: 10000;
}
#toast.show{
  opacity:1;
  pointer-events:auto;
  transform: translateX(-50%) translateY(0);
}
#toast .t{
  font-size:13px;
  color: rgba(231,238,255,.92);
  line-height:1.35;
}
#toast .x{
  width:40px;height:40px;
  border-radius:14px;
  display:grid;place-items:center;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
  cursor:pointer;
  user-select:none;
}
#toast .x:hover{ filter: brightness(1.06); }

/* buttons + ripple */
.actions{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:14px; }
.btn{
  position:relative;
  display:inline-flex; align-items:center; justify-content:center;
  gap:10px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
  color: var(--text);
  padding: 10px 14px;
  border-radius: 16px;
  min-height:44px;
  cursor:pointer;
  transition: transform .18s var(--spring), box-shadow .22s ease, filter .18s ease;
  overflow:hidden;
  user-select:none;
}
.btn:hover{ transform: translateY(-2px); box-shadow: 0 14px 55px rgba(0,0,0,.28); filter: brightness(1.06); }
.btn:active{ transform: translateY(0) scale(.985); }
.btn:disabled{ opacity:.6; cursor:not-allowed; transform:none !important; box-shadow:none !important; }

.btn::before{
  content:"";
  position:absolute; inset:-30% -60%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.12), transparent);
  transform: translateX(-60%) rotate(10deg);
  opacity:0;
}
.btn:hover::before{
  opacity:1;
  animation: sheen 1.2s ease-in-out infinite;
}
@keyframes sheen{
  0%{ transform: translateX(-65%) rotate(10deg); }
  100%{ transform: translateX(65%) rotate(10deg); }
}

.btn .ic{
  width:18px; height:18px; display:inline-block;
  filter: drop-shadow(0 6px 20px rgba(0,0,0,.25));
}
.btn.primary{
  border:none;
  background: linear-gradient(135deg, var(--accent), var(--good));
  color:#061023;
  font-weight: 950;
}
.btn.ghost{ background: rgba(0,0,0,.22); }

.ripple{
  position:absolute;
  border-radius:999px;
  transform: scale(0);
  opacity: .6;
  pointer-events:none;
  background: rgba(255,255,255,.22);
  animation: ripple .55s ease-out forwards;
}
@keyframes ripple{ to{ transform: scale(1); opacity:0; } }

/* note */
.note{
  display:flex; gap:10px; align-items:flex-start;
  margin-top: 14px; padding: 12px;
  border-radius: 18px;
  border:1px solid rgba(255,204,102,.16);
  background: rgba(255,204,102,.06);
  color: rgba(255,232,190,.95);
  font-size: 12px; line-height:1.4;
  transition: transform .2s var(--spring), filter .2s ease;
}
.card:hover .note{ transform: translateY(-1px); filter: brightness(1.03); }
.note .ico{ width:18px; height:18px; border-radius:8px; display:grid; place-items:center; background: rgba(255,204,102,.12); }

/* right sticky */
.right-wrap{ position: sticky; top: 14px; }
@media (max-width: 980px){ .right-wrap{position: static} }

.tag{
  display:inline-flex; align-items:center; gap:8px;
  padding:8px 12px; border-radius:999px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
  font-size:12px;
  transition: transform .18s var(--spring);
}
.card:hover .tag{ transform: translateY(-1px); }
.tag .miniDot{ width:8px; height:8px; border-radius:999px; background: rgba(255,255,255,.35); }

.meter{
  display:flex; align-items:center; gap:14px;
  padding: 14px;
  border-radius: 20px;
  border:1px solid rgba(255,255,255,.14);
  background: linear-gradient(180deg, rgba(0,0,0,.18), rgba(255,255,255,.03));
  animation: fadeIn .45s var(--spring) both;
}
.ring{ width:78px; height:78px; display:grid; place-items:center; position:relative; flex:0 0 auto; }
.ring svg{ transform: rotate(-90deg); }
.ring .num{ position:absolute; inset:0; display:grid; place-items:center; font-weight:950; font-size:18px; }

.bar{
  height:10px; border-radius:999px; overflow:hidden;
  background: rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.12);
  margin-top: 8px;
}
.bar > div{ height:100%; width:0%; transition: width .10s linear; }

/* accordion */
.block{
  margin-top: 14px;
  border-radius: 18px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(0,0,0,.14);
  overflow:hidden;
  transition: transform .2s var(--spring), box-shadow .2s ease;
}
.block:hover{ transform: translateY(-1px); box-shadow: 0 18px 60px rgba(0,0,0,.22); }
.blockHead{
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  padding: 12px 14px;
  cursor:pointer; user-select:none;
}
.blockHead h3{ margin:0; font-size: 13px; font-weight: 950; }

.chev{
  width:42px; height:42px; border-radius: 999px;
  display:grid; place-items:center;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.05);
  transition: transform .35s var(--spring), background .22s ease;
}
.block:hover .chev{ background: rgba(255,255,255,.06); }
.block.open .chev{ transform: rotate(180deg); }

.accWrap{ height: 0px; overflow:hidden; }
.accInner{
  padding: 0 14px 14px;
  opacity: 0;
  transform: translateY(-8px) scale(.99);
  filter: blur(6px);
  transition: opacity .22s ease, transform .35s var(--spring), filter .22s ease;
  transform-origin: top;
}
.block.open .accInner{
  opacity:1;
  transform: translateY(0) scale(1);
  filter: blur(0);
}

/* reasons cards */
.reasons-grid{ display:grid; gap:10px; margin-top: 6px; }
.reason{
  display:flex; gap:10px;
  padding: 12px;
  border-radius: 18px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.04);
  transition: transform .2s var(--spring), filter .2s ease;
}
.reason:hover{ transform: translateY(-1px); filter: brightness(1.04); }
.reason .ico{
  width:38px; height:38px;
  border-radius: 18px;
  display:grid; place-items:center;
  background: linear-gradient(135deg, rgba(106,166,255,.12), rgba(46,229,157,.10));
  border:1px solid rgba(255,255,255,.12);
  flex:0 0 auto;
}
.reason .txt{ font-size:13px; line-height:1.4; }
.reason .sub{ font-size:12px; color: var(--muted2); margin-top:2px; }

ul{ margin:0; padding-left:18px; }
li{ margin: 6px 0; line-height: 1.45; color: rgba(231,238,255,.92); }

/* highlight */
.hl{
  white-space: pre-wrap;
  line-height: 1.45;
  border:1px dashed rgba(255,255,255,.18);
  border-radius: 16px;
  padding: 12px;
  background: rgba(255,255,255,.04);
  position:relative;
  overflow:hidden;
}
.hl::after{
  content:"";
  position:absolute; top:-50%; left:-60%;
  width:40%; height:200%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.10), transparent);
  transform: rotate(12deg);
  opacity:0;
}
.hl.scan::after{ opacity:1; animation: scan 1.1s ease-in-out infinite; }
@keyframes scan { 0%{transform:translateX(-120%)} 100%{transform:translateX(120%)} }
mark{ background: rgba(255,92,122,.26); border-radius: 6px; padding: 1px 4px; }

/* empty state */
.empty-state{
  margin-top: 14px;
  display:grid; gap:10px;
  padding: 14px;
  border-radius: 20px;
  border:1px dashed rgba(255,255,255,.18);
  background: rgba(255,255,255,.03);
  animation: fadeIn .45s var(--spring) both;
}
.empty-state b{ font-size:13px; }
.empty-state .muted{ color: var(--muted2); font-size:12px; line-height:1.4; }
.kbd{
  display:inline-block;
  padding: 2px 8px;
  border-radius: 10px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.25);
  font-size: 12px;
  color: var(--text);
}

/* ===== Loading overlay (BAR instead of spinner) ===== */
#loading{
  position:fixed; inset:0;
  display:grid;
  place-items:center;
  padding:18px;
  background: rgba(2,6,14,.72);
  backdrop-filter: blur(10px);
  z-index: 9999;
  opacity:0;
  pointer-events:none;
  transition: opacity .22s ease;
}
#loading.show{ opacity:1; pointer-events:auto; }

.loading-box{
  width: min(620px, 92vw);
  background: rgba(15,27,51,.92);
  border:1px solid rgba(255,255,255,.14);
  border-radius: 22px;
  padding: 18px 18px 16px;
  box-shadow: var(--shadow);
  animation: pop .35s var(--spring) both;
  position:relative;
  overflow:hidden;
}
@keyframes pop{ from{transform:translateY(10px) scale(.98);opacity:0} to{transform:translateY(0) scale(1);opacity:1} }

.loading-top{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:14px;
}
.loading-title{
  font-weight:950;
}
.loading-sub{
  margin-top:4px;
  color: var(--muted2);
  font-size:12.5px;
  line-height:1.35;
}
.loading-pct{
  font-weight:950;
  font-size: 13px;
  color: rgba(231,238,255,.90);
  padding: 6px 10px;
  border-radius: 999px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.05);
  white-space:nowrap;
}

.loading-bar{
  margin-top: 14px;
  height: 12px;
  border-radius: 999px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
  overflow:hidden;
  position:relative;
}
.loading-fill{
  height:100%;
  width: 0%;
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(106,166,255,.95), rgba(46,229,157,.95));
  transition: width .22s var(--spring);
  position:relative;
}
.loading-fill::after{
  content:"";
  position:absolute; inset:-30% -40%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.22), transparent);
  transform: translateX(-70%) rotate(12deg);
  opacity:.85;
  animation: loadSheen 1.05s ease-in-out infinite;
  mix-blend-mode: screen;
}
@keyframes loadSheen{
  0%{ transform: translateX(-70%) rotate(12deg); opacity:.25; }
  55%{ opacity:.55; }
  100%{ transform: translateX(70%) rotate(12deg); opacity:.25; }
}

/* show logo ONLY in topbar (kills left duplicate if exists) */
.logo{ display:none !important; }
.topbar .logo{ display:grid !important; }

/* ===== MOBILE UI FADE-IN (only mobile) ===== */
@media (pointer: coarse), (max-width: 900px){
  body:not(.fg-ready) .fluid,
  body:not(.fg-ready) .wrap{
    opacity: 0;
    transform: translateY(8px);
  }

  body.fg-ready .fluid,
  body.fg-ready .wrap{
    opacity: 1;
    transform: none;
    transition: opacity .6s ease, transform .6s cubic-bezier(.16,1,.3,1);
  }
}

/* ===== MOBILE ULTRA PERF PATCH (NO DELETES) ===== */
@media (pointer: coarse), (max-width: 900px){

  /* –°–∞–º–æ–µ —Ç—è–∂—ë–ª–æ–µ ‚Äî SVG turbulence/displacement.
     HTML –Ω–µ —Ç—Ä–æ–≥–∞–µ–º: –ø—Ä–æ—Å—Ç–æ –ù–ï —Ä–µ–Ω–¥–µ—Ä–∏–º svg –Ω–∞ –º–æ–±–∏–ª–µ. */
  .fluid svg{ display:none !important; }

  /* –û—Å—Ç–∞—ë—Ç—Å—è vignette (–≥—Ä–∞–¥–∏–µ–Ω—Ç—ã) ‚Äî –¥–µ—à–µ–≤–æ */
  .fluid{
    opacity:.55 !important;
    filter:none !important;
  }

  /* Backdrop blur –æ—á–µ–Ω—å –≥—Ä—É–∑–∏—Ç –º–æ–±–∏–ª—ã */
  .card, .pill, .langSel, #toast, #loading, .loading-box{
    backdrop-filter:none !important;
  }

  /* –£–±–∏—Ä–∞–µ–º ‚Äú–≤–µ—á–Ω—ã–µ‚Äù –∞–Ω–∏–º–∞—Ü–∏–∏/—Å–≤–µ—á–µ–Ω–∏—è */
  .tab-ind::after,
  .loading-fill::after,
  .hl.scan::after,
  .btn::before{
    animation:none !important;
  }

  /* –ù–∞ –º–æ–±–∏–ª–µ hover –Ω–µ –Ω—É–∂–µ–Ω */
  .btn:hover, .chip:hover, .card:hover{
    transform:none !important;
    filter:none !important;
  }

  /* –ß—É—Ç—å –ª–µ–≥—á–µ —Ç–µ–Ω–∏ */
  .card{ box-shadow: 0 18px 70px rgba(0,0,0,.45) !important; }

  /* –õ—ë–≥–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ */
  .card{ contain: layout paint; }
}

/* ===== MOBILE UI FIX: tabs are —Ä–µ–∞–ª—å–Ω–æ –Ω–∞–∂–∏–º–∞–µ–º—ã –∏ –Ω–æ—Ä–º –≤—ã–≥–ª—è–¥—è—Ç ===== */
@media (pointer: coarse), (max-width: 900px){

  /* —Ç–∞–±-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–µ –¥–æ–ª–∂–µ–Ω –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–∫–∏ */
  .tab-ind{
    pointer-events: none !important;
  }

  /* –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç–∞–±–æ–≤ ‚Äî –±–æ–ª—å—à–µ –∏ —É–¥–æ–±–Ω–µ–µ */
  .tabs{
    gap: 8px !important;
    padding: 10px !important;
    min-height: 56px !important;
    border-radius: 22px !important;
  }

  /* —Å–∞–º–∏ –∫–Ω–æ–ø–∫–∏ */
  .tab{
    min-height: 52px !important;
    font-size: 15px !important;
    letter-spacing: .2px !important;
    border-radius: 18px !important;
    padding: 12px 10px !important;
    touch-action: manipulation;
  }

  /* —á—Ç–æ–±—ã –∞–∫—Ç–∏–≤–Ω–∞—è –±—ã–ª–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —á–∏—Ç–∞–µ–º–æ–π */
  .tab.active{
    filter: brightness(1.06);
  }

  /* –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —á—Ç–æ –æ–Ω–∏ –≤—Å–µ–≥–¥–∞ –ø–æ–≤–µ—Ä—Ö –∏ –∫–ª–∏–∫–∞—é—Ç—Å—è */
  #modeTabs{
    position: relative;
    z-index: 5;
  }
  #modeTabs .tab{
    position: relative;
    z-index: 6;
  }

  /* –Ω–∞ –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö ‚Äî –¥–µ–ª–∞–µ–º –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ –∏ –±–µ–∑ —Å–ª–∏–ø–∞–Ω–∏—è */
  @media (max-width: 390px){
    .tabs{
      gap: 6px !important;
      padding: 8px !important;
      min-height: 54px !important;
    }
    .tab{
      font-size: 14px !important;
      min-height: 50px !important;
      padding: 11px 8px !important;
    }
  }
}

/* ===== MOBILE FIX: tabs "–ë—ã—Å—Ç—Ä–æ/–ü–æ–¥—Ä–æ–±–Ω–æ" –≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω—ã –∏ –∫–ª–∏–∫–∞—é—Ç—Å—è ===== */
@media (pointer: coarse), (max-width: 900px){

  /* 1) –ó–∞–≥–æ–ª–æ–≤–æ–∫ + —Ç–∞–±—ã –≤ –∫–æ–ª–æ–Ω–∫—É, —á—Ç–æ–±—ã —Ç–∞–±—ã –Ω–µ —Å–∂–∏–º–∞–ª–∏—Å—å */
  .header-row{
    flex-direction: column !important;
    align-items: stretch !important;
    gap: 10px !important;
  }

  /* 2) –¢–∞–±—ã –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */
  .tabs{
    width: 100% !important;
    transform: none !important;
  }

  /* 3) –ù–∞ –º–æ–±–∏–ª–µ –¥–µ–ª–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ—â–µ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ (–±–µ–∑ gap-—Å–¥–≤–∏–≥–∞) */
  .tabs{
    gap: 0 !important;              /* –∏–Ω–∞—á–µ —Ñ–æ—Ä–º—É–ª–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ —É–µ–∑–∂–∞–µ—Ç */
    padding: 8px !important;
    min-height: 56px !important;
    border-radius: 22px !important;
  }

  .tab{
    min-height: 52px !important;
    font-size: 15px !important;
    padding: 12px 10px !important;
    border-radius: 18px !important;
    touch-action: manipulation;
  }

  /* –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä: —Ä–æ–≤–Ω–æ –ø–æ–ª–æ–≤–∏–Ω–∞ */
  .tab-ind{
    pointer-events: none !important;
    left: var(--tabsPad) !important;
    top: var(--tabsPad) !important;
    bottom: var(--tabsPad) !important;
    width: calc(50% - var(--tabsPad)) !important;
    transform: translateX(calc(var(--i) * 100%)) !important;
  }
}

/* ===== Image Upload UI ===== */
.imgBox{
  position:relative;
  margin-top: 10px;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.03);
  border-radius: 18px;
  padding: 12px;
}
.imgBox.drag{
  border-color: rgba(124,231,255,.55);
  box-shadow: 0 0 0 1px rgba(124,231,255,.35), 0 16px 40px rgba(0,0,0,.35);
  transform: translateY(-1px);
}
.imgBox.drag::after{
  content:"";
  position:absolute;
  inset:10px;
  border-radius: 14px;
  border: 1px dashed rgba(124,231,255,.5);
  pointer-events:none;
  filter: drop-shadow(0 8px 20px rgba(124,231,255,.08));
  animation: dash 1.2s linear infinite;
}
@keyframes dash{
  to{ opacity:.55; }
}

.imgRow{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
}

.imgInput{
  display:none; /* –≤—ã–±–∏—Ä–∞–µ–º —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É */
}

.imgHint{
  margin-top: 8px;
  font-size: 12px;
  color: var(--muted2);
  line-height: 1.35;
}

.thumbs{
  margin-top: 10px;
  display:grid;
  grid-template-columns: repeat(3, minmax(0,1fr));
  gap:10px;
}

.thumb{
  border-radius: 16px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(0,0,0,.18);
  position:relative;
}

.thumb img{
  width:100%;
  height:96px;
  object-fit: cover;
  display:block;
}

.thumb .meta{
  position:absolute;
  left:8px; right:8px; bottom:8px;
  font-size: 11px;
  color: rgba(231,238,255,.92);
  padding: 6px 8px;
  border-radius: 12px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.35);
  backdrop-filter: blur(10px);
  display:flex;
  justify-content:space-between;
  gap:8px;
}

.thumb .x{
  cursor:pointer;
  user-select:none;
  opacity:.9;
}
.thumb .x:hover{ opacity:1; }

@media (pointer: coarse), (max-width: 900px){
  .thumbs{ grid-template-columns: repeat(2, minmax(0,1fr)); }
  .thumb img{ height: 110px; }
}

/* ===== Image upload progress bar (local) ===== */
.imgProg{
  margin-top: 8px;
  padding: 10px 10px 12px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,.12);
  background: rgba(0,0,0,.20);
  display:none;
}
.imgProg.show{ display:block; }

.imgProgTop{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  color: rgba(231,238,255,.92);
  font-size: 12px;
}
.imgProgTop span:last-child{
  padding: 4px 8px;
  border-radius: 999px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.05);
  font-weight: 950;
}

.imgProgBar{
  margin-top: 10px;
  height: 10px;
  border-radius: 999px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
  overflow:hidden;
}
.imgProgFill{
  height:100%;
  width:0%;
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(106,166,255,.95), rgba(46,229,157,.95));
  transition: width .20s var(--spring);
  position:relative;
}
.imgProgFill::after{
  content:"";
  position:absolute; inset:-35% -45%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.22), transparent);
  transform: translateX(-70%) rotate(12deg);
  opacity:.85;
  animation: imgSheen 1.05s ease-in-out infinite;
  mix-blend-mode: screen;
}
@keyframes imgSheen{
  0%{ transform: translateX(-70%) rotate(12deg); opacity:.25; }
  55%{ opacity:.55; }
  100%{ transform: translateX(70%) rotate(12deg); opacity:.25; }
}

/* —á—É—Ç—å –±–æ–ª—å—à–µ ‚Äú–≤–∞—É‚Äù –¥–ª—è –∫–æ—Ä–æ–±–∫–∏ —Ñ–æ—Ç–æ */
.imgBox{
  position:relative;
  overflow:hidden;
}
.imgBox::before{
  content:"";
  position:absolute; inset:-1px;
  pointer-events:none;
  background:
    radial-gradient(700px 220px at 15% 0%, rgba(106,166,255,.10), transparent 60%),
    radial-gradient(700px 220px at 85% 0%, rgba(46,229,157,.08), transparent 60%);
  opacity:.9;
}
.imgBox > *{ position:relative; }


/* ===== Micro-animations everywhere (jury-friendly) ===== */
.reveal{
  opacity:0;
  transform: translateY(14px) scale(.985);
  filter: blur(10px);
  transition: opacity .75s var(--ease), transform .75s var(--ease), filter .75s var(--ease);
  will-change: opacity, transform, filter;
}
.reveal.in{
  opacity:1;
  transform:none;
  filter:none;
}

.btn, .chip, .tabBtn{
  position:relative;
  overflow:hidden;
}
.ripple{
  position:absolute;
  border-radius:999px;
  transform: translate(-50%,-50%) scale(0);
  opacity:.35;
  background: currentColor;
  filter: blur(.2px);
  pointer-events:none;
  animation: ripple .55s var(--ease) forwards;
}
@keyframes ripple{
  to{ transform: translate(-50%,-50%) scale(18); opacity:0; }
}

/* Touch devices: lighten heavy effects a bit */
@media (max-width: 640px){
  .fluid{ opacity:.58; filter: blur(30px) saturate(1.05); }
  .noise{ opacity:.10; }
}


/* ===== URL LOADING SHIMMER ===== */
.input-loading{
  position: relative;
  overflow: hidden;
}
.input-loading::after{
  content:"";
  position:absolute;
  inset:0;
  background: linear-gradient(110deg,
    transparent 0%,
    rgba(255,255,255,.08) 45%,
    rgba(255,255,255,.18) 50%,
    rgba(255,255,255,.08) 55%,
    transparent 100%);
  animation: urlShimmer 1.1s ease-in-out infinite;
  pointer-events:none;
}
@keyframes urlShimmer{
  from{ transform: translateX(-120%); }
  to{ transform: translateX(120%); }
}

</style>
</head>
<body>
<!-- Fluid background -->
<div class="fluid" aria-hidden="true">
  <svg viewBox="0 0 1200 800" preserveAspectRatio="none">
    <defs>
      <filter id="turb">
        <feTurbulence type="fractalNoise" baseFrequency="0.012" numOctaves="2" seed="8" result="noise">
          <animate attributeName="baseFrequency" dur="10s" values="0.010;0.016;0.012" repeatCount="indefinite"/>
          <animate attributeName="seed" dur="14s" values="8;12;8" repeatCount="indefinite"/>
        </feTurbulence>
        <feDisplacementMap in="SourceGraphic" in2="noise" scale="42" xChannelSelector="R" yChannelSelector="G"/>
        <feGaussianBlur stdDeviation="0.4"/>
      </filter>

      <radialGradient id="g1" cx="30%" cy="25%" r="70%">
        <stop offset="0%" stop-color="rgba(106,166,255,.55)"/>
        <stop offset="55%" stop-color="rgba(106,166,255,.12)"/>
        <stop offset="100%" stop-color="rgba(0,0,0,0)"/>
      </radialGradient>
      <radialGradient id="g2" cx="70%" cy="28%" r="70%">
        <stop offset="0%" stop-color="rgba(46,229,157,.45)"/>
        <stop offset="60%" stop-color="rgba(46,229,157,.10)"/>
        <stop offset="100%" stop-color="rgba(0,0,0,0)"/>
      </radialGradient>
      <radialGradient id="g3" cx="50%" cy="80%" r="80%">
        <stop offset="0%" stop-color="rgba(255,92,122,.30)"/>
        <stop offset="65%" stop-color="rgba(255,92,122,.08)"/>
        <stop offset="100%" stop-color="rgba(0,0,0,0)"/>
      </radialGradient>
    </defs>

    <g filter="url(#turb)" opacity="0.95">
      <rect x="-100" y="-100" width="1400" height="1000" fill="rgba(6,10,20,1)"/>
      <ellipse cx="260" cy="220" rx="520" ry="360" fill="url(#g1)"/>
      <ellipse cx="920" cy="240" rx="560" ry="380" fill="url(#g2)"/>
      <ellipse cx="620" cy="690" rx="760" ry="460" fill="url(#g3)"/>
    </g>
  </svg>
  <div class="vignette"></div>
</div>

<div class="noise"></div>

<div class="wrap">
  <div class="topbar reveal">
    <div class="brand">
      <div class="logo">FG</div>
      <div>
        <h1>FraudGuard</h1>
        <div class="sub">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —Å—Å—ã–ª–æ–∫ –Ω–∞ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ</div>
      </div>
    </div>

    <div class="badges">
      <span class="pill"><span class="dot"></span><span id="pillAI">–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞</span></span>
      <span class="pill"><span id="pillHot">–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏:</span> <span class="kbd">Ctrl</span> + <span class="kbd">Enter</span></span>

      <span class="langSel" id="langSel" title="Language">
        <span id="langLabel">–Ø–∑—ã–∫</span>
        <select id="lang" aria-label="Language">
          <option value="ru" selected>RU</option>
          <option value="en">EN</option>
        </select>
      </span>
    </div>
  </div>

  <div class="grid">
    <div class="card tilt reveal" id="leftCard">
      <div class="header-row depth-1">
        <div>
          <div class="title" id="checkTitle">–ü—Ä–æ–≤–µ—Ä–∫–∞</div>
          <div class="caption" id="checkCaption">–í—Å—Ç–∞–≤—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∏/–∏–ª–∏ —Å—Å—ã–ª–∫—É ‚Äî –ø–æ–ª—É—á–∏—à—å —Å–∫–æ—Ä, –ø—Ä–∏—á–∏–Ω—ã –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</div>
        </div>

        <div class="tabs depth-2" id="modeTabs">
          <div class="tab-ind" aria-hidden="true"></div>
          <button class="tab active" id="tabQuick" type="button">–ë—ã—Å—Ç—Ä–æ</button>
          <button class="tab" id="tabPro" type="button">–ü–æ–¥—Ä–æ–±–Ω–æ</button>
        </div>
      </div>

      <div class="modeAnim" id="modeAnim">
        <div id="proWrap" class="proWrap depth-1" aria-hidden="true" aria-hidden="true">
          <div class="label" id="fromLabel">–û—Ç –∫–æ–≥–æ –ø—Ä–∏—à–ª–æ (–æ–ø—Ü.)</div>
          <input id="from" placeholder='–Ω–∞–ø—Ä–∏–º–µ—Ä: "[–¢–ï–°–¢] –°–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ ‚Ä¢ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å"'>
        </div>

        <div class="depth-1">
          <div class="label" id="urlLabel">–°—Å—ã–ª–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)</div>
          <input id="url" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: https://bank-secure.example/verify">
        </div>

        <div class="depth-1">
          <div class="label" id="textLabel">–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è</div>
          <textarea id="text" placeholder="–í—Å—Ç–∞–≤—å SMS –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ..."></textarea>

          <div class="helperRow">
            <span id="smartPasteHint">üí° –í—Å—Ç–∞–≤–ª—è–π —Ç–µ–∫—Å—Ç ‚Äî —Å—Å—ã–ª–∫—É –≤—ã—Ç–∞—â–∏–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</span>
            <span class="counter"><span id="cntLabel">–°–∏–º–≤–æ–ª—ã:</span> <b id="charCount">0</b></span>
          </div>
        </div>
      </div>

      <!-- ===== Image Upload (screenshots) ===== -->
<div class="depth-1">
  <div class="label" id="imgLabel">–°–∫—Ä–∏–Ω—à–æ—Ç—ã/—Ñ–æ—Ç–æ (–æ–ø—Ü.)</div>

  <div class="imgBox" id="imgBox">
    <div class="imgRow">
      <input id="imgInput" class="imgInput" type="file" accept="image/*" multiple>
      <button class="btn" id="btnImgPick" type="button">
        <span class="ic" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" width="18" height="18">
            <path d="M4 7h4l2-2h4l2 2h4v12H4V7z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M12 17a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" stroke="currentColor" stroke-width="2"/>
          </svg>
        </span>
        <span id="btnImgPickTxt">–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</span>
      </button>

      <button class="btn ghost" id="btnImgClear" type="button">
        <span class="ic" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" width="18" height="18">
            <path d="M6 7h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M9 7V5h6v2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M8 7l1 14h6l1-14" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
          </svg>
        </span>
        <span id="btnImgClearTxt">–£–±—Ä–∞—Ç—å</span>
      </button>
    </div>

<div class="imgProg" id="imgProg" aria-hidden="true">
  <div class="imgProgTop">
    <span id="imgProgTxt">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ‚Ä¶</span>
    <span id="imgProgPct">0%</span>
  </div>
  <div class="imgProgBar" aria-hidden="true">
    <div class="imgProgFill" id="imgProgFill"></div>
  </div>
</div>

    <div class="imgHint" id="imgHint">
      –î–æ–±–∞–≤—å —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –ø–µ—Ä–µ–ø–∏—Å–∫–∏/—Å–∞–π—Ç–∞. –ú—ã —Å–æ–∂–º—ë–º –∏—Ö, —á—Ç–æ–±—ã —Ç–µ–ª–µ—Ñ–æ–Ω –Ω–µ –ª–∞–≥–∞–ª.
    </div>

    <div class="thumbs" id="thumbs" aria-live="polite"></div>
  </div>
</div>


      <div class="chips depth-1 reveal">
        <button class="chip" type="button" data-chip="–°–†–û–ß–ù–û: –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ª–∏—á–Ω–æ—Å—Ç—å (—Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä)" id="chipUrgent">—Å—Ä–æ—á–Ω–æ</button>
        <button class="chip" type="button" data-chip="–ó–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç –∫–æ–¥ –∏–∑ SMS (—Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä)" id="chipCode">–ø—Ä–æ—Å–∏—Ç –∫–æ–¥</button>
        <button class="chip" type="button" data-chip="–ü—Ä–æ—Å—è—Ç –ø–µ—Ä–µ–π—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ (—Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä)" id="chipLink">–ø–æ–¥–æ–∑—Ä. —Å—Å—ã–ª–∫–∞</button>
        <button class="chip" type="button" data-chip="–ü—Ä–æ—Å—è—Ç –ø–µ—Ä–µ–≤–æ–¥ –¥–µ–Ω–µ–≥ (—Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä)" id="chipMoney">–ø–µ—Ä–µ–≤–æ–¥ –¥–µ–Ω–µ–≥</button>
        <button class="chip" type="button" data-chip="–£–≥—Ä–æ–∂–∞—é—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π (—Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä)" id="chipThreat">—É–≥—Ä–æ–∑–∞</button>
      </div>

      <div class="actions depth-1">
        <button class="btn primary" id="btnCheck" type="button">
          <span class="ic" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" width="18" height="18">
              <path d="M12 3l8 4v6c0 5-3.2 8.4-8 9-4.8-.6-8-4-8-9V7l8-4z" stroke="#071223" stroke-width="2"/>
              <path d="M8.5 12.2l2.2 2.3 4.8-5" stroke="#071223" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <span id="btnCheckTxt">–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É</span>
        </button>

        <button class="btn ghost" id="btnClear" type="button">
          <span class="ic" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" width="18" height="18">
              <path d="M6 7h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M9 7V5h6v2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M8 7l1 14h6l1-14" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            </svg>
          </span>
          <span id="btnClearTxt">–û—á–∏—Å—Ç–∏—Ç—å</span>
        </button>

        <button class="btn" id="btnDemo" type="button">
          <span class="ic" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" width="18" height="18">
              <path d="M4 6h16v12H4z" stroke="currentColor" stroke-width="2" />
              <path d="M8 10h8M8 14h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </span>
          <span id="btnDemoTxt">–ü—Ä–∏–º–µ—Ä</span>
        </button>
      </div>

      <div class="note depth-1">
        <div class="ico">‚ö†Ô∏è</div>
        <div id="noteTxt">–ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–æ–æ–±—â–∞–π –∫–æ–¥—ã –∏–∑ SMS/Push, –ø–∞—Ä–æ–ª–∏, CVV/CVC –∏ PIN. –ù–∞—Å—Ç–æ—è—â–∏–π –±–∞–Ω–∫ –Ω–µ –ø—Ä–æ—Å–∏—Ç —ç—Ç–æ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö.</div>
      </div>
    </div>

    <div class="right-wrap">
      <div class="card tilt reveal" id="rightCard">
        <div class="header-row depth-1">
          <div>
            <div class="title" id="resTitle">–†–µ–∑—É–ª—å—Ç–∞—Ç</div>
            <div class="caption" id="resCaption">–°–∫–æ—Ä + –ø—Ä–∏—á–∏–Ω—ã + —á—Ç–æ –¥–µ–ª–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ</div>
          </div>
          <span class="tag depth-2" id="categoryTag">
            <span class="miniDot"></span><span id="catText">‚Äî</span>
          </span>
        </div>

        <div class="meter depth-1" id="compactMeter">
          <div id="scoreBox">
            <div class="ring">
              <svg width="78" height="78" viewBox="0 0 78 78">
                <circle id="ringBg" cx="39" cy="39" r="31" stroke="rgba(255,255,255,.10)" stroke-width="8" fill="none"></circle>
                <circle id="ringFg" cx="39" cy="39" r="31" stroke="var(--accent)" stroke-width="8" fill="none"
                  stroke-linecap="round" stroke-dasharray="0 194.78"></circle>
              </svg>
              <div class="num" id="ringNum">0</div>
            </div>
          </div>
          <div style="flex:1">
            <div class="caption" id="riskCaption">–†–∏—Å–∫-—Å–∫–æ—Ä</div>
            <div style="font-weight:950; font-size:16px" id="scoreText">0 / 100</div>
            <div class="bar"><div id="barFill"></div></div>
          </div>
        </div>

        <div id="emptyState" class="empty-state depth-1">
          <b id="emptyB">–ü–æ–∫–∞ –Ω–µ—Ç –∞–Ω–∞–ª–∏–∑–∞</b>
          <div class="muted" id="emptyT">–í—Å—Ç–∞–≤—å —Ç–µ–∫—Å—Ç/—Å—Å—ã–ª–∫—É —Å–ª–µ–≤–∞ –∏ –Ω–∞–∂–º–∏ <span class="kbd">–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É</span>.</div>
        </div>

        <div class="block open depth-1" id="blkWhy">
          <div class="blockHead" data-acc="blkWhy">
            <h3 id="whyTitle">–ü–æ—á–µ–º—É —Ç–∞–∫</h3>
            <div class="chev">‚åÉ</div>
          </div>
          <div class="accWrap"><div class="accInner">
            <div id="reasons" style="color:var(--muted2)">‚Äî</div>
          </div></div>
        </div>

        <div class="block open depth-1" id="blkSafe">
          <div class="blockHead" data-acc="blkSafe">
            <h3 id="safeTitle">–ß—Ç–æ –¥–µ–ª–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ</h3>
            <div class="chev">‚åÉ</div>
          </div>
          <div class="accWrap"><div class="accInner">
            <div id="safe" style="color:var(--muted2)">‚Äî</div>
          </div></div>
        </div>

        <div class="block open depth-1" id="blkHL">
          <div class="blockHead" data-acc="blkHL">
            <h3 id="hlTitle">–ü–æ–¥—Å–≤–µ—Ç–∫–∞ –æ–ø–∞—Å–Ω—ã—Ö —Ñ—Ä–∞–∑</h3>
            <div class="chev">‚åÉ</div>
          </div>
          <div class="accWrap"><div class="accInner">
            <div id="highlight" class="hl">‚Äî</div>
          </div></div>
        </div>

      </div>
    </div>
  </div>
</div>

<div id="loading" aria-hidden="true">
  <div class="loading-box">
    <div class="loading-top">
      <div>
        <div class="loading-title" id="loadingTitle">–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º‚Ä¶</div>
        <div class="loading-sub" id="loadingSub">–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∏ —Å–∫–∞–º–∞ –∏ —Ñ–∏—à–∏–Ω–≥–∞</div>
      </div>
      <div class="loading-pct"><span id="loadingPct">0</span>%</div>
    </div>

    <div class="loading-bar" aria-hidden="true">
      <div class="loading-fill" id="loadingFill"></div>
    </div>
  </div>
</div>

<div id="toast" role="status" aria-live="polite">
  <div class="t" id="toastTxt">‚Äî</div>
  <div class="x" id="toastClose" aria-label="Close">‚úï</div>
</div>
<script>
/* Cloudflare Worker endpoint (–í–ê–ñ–ù–û: /analyze, –∞ –Ω–µ –∫–æ—Ä–µ–Ω—å) */
const API_URL = "https://fraudguard-app.guideyeahofc.workers.dev/analyze";

const $ = id => document.getElementById(id);
const state = { lang: "ru", images: [] };

/* ===== Motion: reveal-on-scroll + tasteful ripples ===== */
function initReveals(){
  const prefersReduce = matchMedia("(prefers-reduced-motion: reduce)").matches;
  if(prefersReduce){
    document.querySelectorAll(".reveal").forEach(el=>el.classList.add("in"));
    return;
  }

  const els = [...document.querySelectorAll(".reveal")];
  if(!els.length) return;

  const io = new IntersectionObserver((entries)=>{
    for(const e of entries){
      if(e.isIntersecting){
        e.target.classList.add("in");
        io.unobserve(e.target);
      }
    }
  }, { threshold: 0.10, rootMargin: "80px 0px -10px 0px" });

  els.forEach(el=>io.observe(el));
}

function initRipples(){
  const prefersReduce = matchMedia("(prefers-reduced-motion: reduce)").matches;
  if(prefersReduce) return;

  const add = (el)=>{
    el.addEventListener("pointerdown", (ev)=>{
      if(ev.button !== 0 && ev.pointerType === "mouse") return;
      const rect = el.getBoundingClientRect();
      const x = ev.clientX - rect.left;
      const y = ev.clientY - rect.top;
      const r = document.createElement("span");
      r.className = "ripple";
      r.style.left = x + "px";
      r.style.top  = y + "px";
      r.style.width = r.style.height = Math.max(rect.width, rect.height) + "px";
      el.appendChild(r);
      setTimeout(()=>r.remove(), 650);
    }, { passive:true });
  };

  document.querySelectorAll(".btn, .chip, .tabBtn").forEach(add);
}


/* ===== MOBILE FLAGS (NO REMOVES) ===== */
const FG_IS_TOUCH = matchMedia("(pointer: coarse)").matches || matchMedia("(max-width: 900px)").matches;

/* ===== MOBILE UI READY FLAG ===== */
window.addEventListener("DOMContentLoaded", () => {
  if(FG_IS_TOUCH){
    document.body.classList.add("fg-ready");

    /* –£–±–∏—Ä–∞–µ–º <animate> –≤ SVG (runtime), —á—Ç–æ–±—ã –º–æ–±–∏–ª–∞ –Ω–µ –ª–∞–≥–∞–ª–∞ */
    document.querySelectorAll(".fluid animate").forEach(a=>a.remove());
  } else {
    document.body.classList.add("fg-ready");
  }

  // Entrance animations
  if(typeof initReveals === "function") initReveals();
  if(typeof initRipples === "function") initRipples();
});

const I18N = {
  ru: {
    // Top
    title: "FraudGuard ‚Äî Anti-Scam",
    sub: "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, —Å—Å—ã–ª–æ–∫ –∏ –≤–ª–æ–∂–µ–Ω–∏–π –Ω–∞ –ø—Ä–∏–∑–Ω–∞–∫–∏ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞",
    pillAI: "–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç‚Äë–ø—Ä–æ–≤–µ—Ä–∫–∞",
    pillHotkeys: "–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏:",
    langLabel: "–Ø–∑—ã–∫",
    langTitle: "–í—ã–±–æ—Ä —è–∑—ã–∫–∞",

    // Check card
    checkTitle: "–ü—Ä–æ–≤–µ—Ä–∫–∞",
    checkCaption: "–í—Å—Ç–∞–≤—å —Ç–µ–∫—Å—Ç –∏/–∏–ª–∏ —Å—Å—ã–ª–∫—É ‚Äî –ø–æ–ª—É—á–∏—à—å –æ—Ü–µ–Ω–∫—É —Ä–∏—Å–∫–∞, –ø—Ä–∏—á–∏–Ω—ã –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è",
    tabQuick: "–ë—ã—Å—Ç—Ä–æ",
    tabPro: "–ü–æ–¥—Ä–æ–±–Ω–æ",

    fromLabel: "–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)",
    fromPh: '–Ω–∞–ø—Ä–∏–º–µ—Ä: "[–¢–ï–°–¢] –°–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ ‚Ä¢ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å"',
    urlLabel: "–°—Å—ã–ª–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)",
    urlPh: "–Ω–∞–ø—Ä–∏–º–µ—Ä: https://bank-secure.example",
    textLabel: "–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è",
    textPh: "–í—Å—Ç–∞–≤—å —Å—é–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶",
    smartPaste: "–°–æ–≤–µ—Ç: –º–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å —Å—Ä–∞–∑—É –∏ —Ç–µ–∫—Å—Ç, –∏ —Å—Å—ã–ª–∫—É ‚Äî –º—ã —Ä–∞–∑–±–µ—Ä—ë–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏",
    cntLabel: "–°–∏–º–≤–æ–ª–æ–≤",

    // Chips
    chipUrgent: "–°—Ä–æ—á–Ω–æ—Å—Ç—å",
    chipCode: "–ö–æ–¥—ã/OTP",
    chipLink: "–°—Å—ã–ª–∫–∏",
    chipMoney: "–î–µ–Ω—å–≥–∏",
    chipThreat: "–£–≥—Ä–æ–∑—ã",

    // Buttons
    btnCheck: "–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É",
    btnClear: "–û—á–∏—Å—Ç–∏—Ç—å",
    btnDemo: "–í—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä",

    // Upload
    imgTitle: "–í–ª–æ–∂–µ–Ω–∏—è",
    imgCaption: "–ü–µ—Ä–µ—Ç–∞—â–∏ —Ñ–∞–π–ª—ã —Å—é–¥–∞ –∏–ª–∏ –≤—ã–±–µ—Ä–∏ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ. –ú—ã —Å–æ–∂–º—ë–º –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞, —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª–æ –±—ã—Å—Ç—Ä–æ.",
    imgPick: "–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã",
    imgHint: "–ü–æ–¥–¥–µ—Ä–∂–∫–∞: PNG/JPG/WEBP ‚Ä¢ –î–æ {n} —Ñ–∞–π–ª–æ–≤",
    imgTooMany: "–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ñ–∞–π–ª–æ–≤ (–ª–∏–º–∏—Ç: {n})",
    imgTooBig: "–°—É–º–º–∞—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –£–±–µ—Ä–∏ –ø–∞—Ä—É —Ñ–∞–π–ª–æ–≤ –∏ –ø–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞.",
    imgProcessing: "–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤–ª–æ–∂–µ–Ω–∏–π‚Ä¶",
    imgReady: "–í–ª–æ–∂–µ–Ω–∏—è –≥–æ—Ç–æ–≤—ã",

    // Note
    note: "–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ü–µ–Ω–∏—Ç—å —Ä–∏—Å–∫–∏, –Ω–æ –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏. –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π –∫–æ–¥—ã –∏ –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã.",

    // Result
    resTitle: "–†–µ–∑—É–ª—å—Ç–∞—Ç",
    resCaption: "–ù–∏–∂–µ ‚Äî –∏—Ç–æ–≥, –∫–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —à–∞–≥–∏",
    riskScore: "–û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–∞",
    emptyB: "–ü–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ",
    emptyT1: "–í—Å—Ç–∞–≤—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –Ω–∞–∂–º–∏ ",
    why: "–ü–æ—á–µ–º—É —Ç–∞–∫",
    safe: "–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ",
    hl: "–ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã",

    // Loader
    loadingB: "–ü—Ä–æ–≤–æ–¥–∏–º –ø—Ä–æ–≤–µ—Ä–∫—É",
    loadingS: "–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É, —è–∑—ã–∫, —Å—Å—ã–ª–∫–∏ –∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã‚Ä¶",

    // Toasts
    toastCopied: "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ",
    toastCleared: "–û—á–∏—â–µ–Ω–æ",
    toastDemo: "–ü—Ä–∏–º–µ—Ä –≤—Å—Ç–∞–≤–ª–µ–Ω",
    toastLinkExtracted: "–°—Å—ã–ª–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∞ –≤ –ø–æ–ª–µ URL",
    toastImgDrop: "–§–∞–π–ª—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã",
    toastImgRemoved: "–£–¥–∞–ª–µ–Ω–æ",
    toastImgCleared: "–í–ª–æ–∂–µ–Ω–∏—è –æ—á–∏—â–µ–Ω—ã",
    imgErrPrefix: "–û—à–∏–±–∫–∞ –≤–ª–æ–∂–µ–Ω–∏–π: ",
    riskLow: "–Ω–∏–∑–∫–∏–π",
    riskMedium: "—Å—Ä–µ–¥–Ω–∏–π",
    riskHigh: "–≤—ã—Å–æ–∫–∏–π",
    officialVerify: "–ü—Ä–æ–≤–µ—Ä—å —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫–∞–Ω–∞–ª (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ/—Å–∞–π—Ç –≤—Ä—É—á–Ω—É—é)",
    jsonErrPrefix: "–§—É–Ω–∫—Ü–∏—è –≤–µ—Ä–Ω—É–ª–∞ –Ω–µ-JSON: ",
    toastModeQuick: "–†–µ–∂–∏–º: –±—ã—Å—Ç—Ä–æ",
    toastModePro: "–†–µ–∂–∏–º: –ø–æ–¥—Ä–æ–±–Ω–æ"
  },
  en: {
    // Top
    title: "FraudGuard ‚Äî Anti-Scam",
    sub: "Professional checks for messages, links, and attachments for scam signals",
    pillAI: "Smart verification",
    pillHotkeys: "Hotkeys:",
    langLabel: "Language",
    langTitle: "Language selector",

    // Check card
    checkTitle: "Check",
    checkCaption: "Paste text and/or a link ‚Äî get a risk score, reasons, and safe next steps",
    tabQuick: "Quick",
    tabPro: "Detailed",

    fromLabel: "Sender (optional)",
    fromPh: 'e.g.: "[TEST] Support ‚Ä¢ Security"',
    urlLabel: "Link (if any)",
    urlPh: "e.g.: https://bank-secure.example",
    textLabel: "Message text",
    textPh: "Paste the message here‚Ä¶",
    smartPaste: "Tip: you can paste both text and a link ‚Äî we'll extract automatically",
    cntLabel: "Characters",

    // Chips
    chipUrgent: "Urgency",
    chipCode: "Codes/OTP",
    chipLink: "Links",
    chipMoney: "Money",
    chipThreat: "Threats",

    // Buttons
    btnCheck: "Run check",
    btnClear: "Clear",
    btnDemo: "Paste example",

    // Upload
    imgTitle: "Attachments",
    imgCaption: "Drag & drop files here or pick on your device. We'll optimize for phones so it stays fast.",
    imgPick: "Choose files",
    imgHint: "Supported: PNG/JPG/WEBP ‚Ä¢ Up to {n} files",
    imgTooMany: "Too many files (limit: {n})",
    imgTooBig: "Total size is too large. Remove a couple of files and try again.",
    imgProcessing: "Optimizing attachments‚Ä¶",
    imgReady: "Attachments ready",

    // Note
    note: "This check helps assess risk, but doesn't replace official support channels. Never share codes or card details.",

    // Result
    resTitle: "Result",
    resCaption: "Summary, key signals, and safe actions",
    riskScore: "Risk score",
    emptyB: "No checks yet",
    emptyT1: "Paste a message and press ",
    why: "Why",
    safe: "Safe next steps",
    hl: "Detected snippets",

    // Loader
    loadingB: "Running verification",
    loadingS: "Analyzing language, links, and behavioral patterns‚Ä¶",

    // Toasts
    toastCopied: "Copied",
    toastCleared: "Cleared",
    toastDemo: "Example pasted",
    toastLinkExtracted: "Link extracted into the URL field",
    toastImgDrop: "Files added",
    toastImgRemoved: "Removed",
    toastImgCleared: "Attachments cleared",
    imgErrPrefix: "Attachment error: ",
    riskLow: "low",
    riskMedium: "medium",
    riskHigh: "high",
    officialVerify: "Verify via official channel (app/site manually)",
    jsonErrPrefix: "Non-JSON response: ",
    toastModeQuick: "Mode: quick",
    toastModePro: "Mode: detailed"
  }
};

function applyLang(next){
  state.lang = (next === "en") ? "en" : "ru";
  const L = I18N[state.lang];

  document.documentElement.lang = state.lang;
  document.title = L.title;

  document.querySelector(".brand .sub").textContent = L.sub;

  $("pillAI").textContent = L.pillAI;
  $("pillHot").textContent = L.pillHotkeys;

  $("langLabel").textContent = L.langLabel;
  if($("langSel")) $("langSel").title = L.langTitle;

  $("checkTitle").textContent = L.checkTitle;
  $("checkCaption").textContent = L.checkCaption;

  $("tabQuick").textContent = L.tabQuick;
  $("tabPro").textContent = L.tabPro;

  $("fromLabel").textContent = L.fromLabel;
  $("from").placeholder = L.fromPh;

  $("urlLabel").textContent = L.urlLabel;
  $("url").placeholder = L.urlPh;

  $("textLabel").textContent = L.textLabel;
  $("text").placeholder = L.textPh;

  $("smartPasteHint").textContent = L.smartPaste;
  $("cntLabel").textContent = L.cntLabel;

  $("chipUrgent").textContent = L.chipUrgent;
  $("chipCode").textContent = L.chipCode;
  $("chipLink").textContent = L.chipLink;
  $("chipMoney").textContent = L.chipMoney;
  $("chipThreat").textContent = L.chipThreat;

  $("btnCheckTxt").textContent = L.btnCheck;
  $("btnClearTxt").textContent = L.btnClear;
  $("btnDemoTxt").textContent = L.btnDemo;

  // Attachments
  if($("imgLabel")) $("imgLabel").textContent = (state.lang==="ru") ? `${L.imgTitle} (–æ–ø—Ü.)` : `${L.imgTitle} (optional)`;
  if($("btnImgPickTxt")) $("btnImgPickTxt").textContent = L.imgPick;
  if($("btnImgClearTxt")) $("btnImgClearTxt").textContent = L.btnClear;
  if($("imgProgTxt")) $("imgProgTxt").textContent = L.imgProcessing;
  if($("imgHint")) $("imgHint").textContent = L.imgCaption;

  $("noteTxt").textContent = L.note;

  $("resTitle").textContent = L.resTitle;
  $("resCaption").textContent = L.resCaption;
  $("riskCaption").textContent = L.riskScore;

  $("emptyB").textContent = L.emptyB;
  $("emptyT").innerHTML = `${L.emptyT1}<span class="kbd">${L.btnCheck}</span>.`;

  $("whyTitle").textContent = L.why;
  $("safeTitle").textContent = L.safe;
  $("hlTitle").textContent = L.hl;

  $("loadingTitle").textContent = L.loadingB;
  $("loadingSub").textContent = L.loadingS;

  // refresh adaptive UI pieces
  if(typeof applyImgProfile === "function") applyImgProfile();
}

function escapeHTML(s){
  return String(s||"").replace(/[&<>"]/g,c=>({ "&":"&amp;","<":"&lt;",">":"&gt;", "\"":"&quot;" }[c]));
}
function clamp01(x){ return Math.max(0, Math.min(1, x)); }

function riskColor(score){
  const s = Number(score)||0;
  if(s < 20) return "var(--good)";
  if(s < 50) return "var(--warn)";
  return "var(--bad)";
}

/* ===== Toast ===== */
let toastTimer = 0;
function showToast(msg){
  const t = $("toast");
  const txt = $("toastTxt");
  if(!t || !txt) return;
  if(msg == null) return;
  msg = String(msg);
  if(!msg.trim()) return;
  txt.textContent = msg;
  t.classList.add("show");
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=> t.classList.remove("show"), 2400);
}
$("toastClose")?.addEventListener("click", ()=> $("toast")?.classList.remove("show"));

/* Ripple */
function addRipple(e){
  const btn = e.currentTarget;
  const rect = btn.getBoundingClientRect();
  const size = Math.max(rect.width, rect.height) * 1.1;
  const x = e.clientX - rect.left - size/2;
  const y = e.clientY - rect.top - size/2;

  const d = document.createElement("span");
  d.className = "ripple";
  d.style.width = d.style.height = size + "px";
  d.style.left = x + "px";
  d.style.top = y + "px";
  btn.appendChild(d);
  setTimeout(()=>d.remove(), 650);
}
["btnCheck","btnClear","btnDemo","tabQuick","tabPro"].forEach(id=>{
  const el = $(id);
  if(el) el.addEventListener("pointerdown", addRipple);
});

/* ===== Tabs ‚Äî WOW –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ + —Å–≤–∞–π–ø—ã (–±–µ–∑ –∞–≤—Ç–æ—Å–∫—Ä–æ–ª–ª–∞) ===== */
let mode = "quick";
let lastMode = "quick";

function setMode(next, how="click"){
  if(next === mode) return;
  lastMode = mode;
  mode = next;

  const isPro = mode === "pro";
  $("tabQuick").classList.toggle("active", !isPro);
  $("tabPro").classList.toggle("active", isPro);
  $("modeTabs").style.setProperty("--i", isPro ? 1 : 0);

  const wrap = $("proWrap");
  wrap.classList.toggle("show", isPro);
  wrap.setAttribute("aria-hidden", String(!isPro));

  // WOW swap animation (direction-aware)
  const anim = $("modeAnim");
  anim.classList.remove("swap");
  anim.dataset.swap = isPro ? "toPro" : "toQuick";
  void anim.offsetWidth;
  anim.classList.add("swap");

  // micro-feedback (–±–µ–∑ –∑–≤—É–∫–∞, –±–µ–∑ —Å–∫—Ä–æ–ª–ª–∞)
  try{
    const btn = isPro ? $("tabPro") : $("tabQuick");
    btn?.animate?.([
      { transform:"translateY(0) scale(1)" },
      { transform:"translateY(-1px) scale(1.02)" },
      { transform:"translateY(0) scale(1)" }
    ], { duration: 260, easing: "cubic-bezier(.2,.9,.2,1)" });
  }catch(e){}
}

$("tabQuick").onclick = ()=> setMode("quick");
$("tabPro").onclick  = ()=> setMode("pro");

// Swipe gesture on the mode container (mobile-friendly)
(function enableModeSwipe(){
  const el = $("modeAnim");
  if(!el) return;
  let sx=0, sy=0, t0=0, tracking=false;

  el.addEventListener("pointerdown", (e)=>{
    // ignore inputs/textarea interactions
    const tag = (e.target?.tagName || "").toLowerCase();
    if(tag === "input" || tag === "textarea" || tag === "button" || e.target?.closest?.("button")) return;

    tracking = true;
    sx = e.clientX; sy = e.clientY;
    t0 = performance.now();
    el.setPointerCapture?.(e.pointerId);
  }, {passive:true});

  el.addEventListener("pointerup", (e)=>{
    if(!tracking) return;
    tracking=false;

    const dx = e.clientX - sx;
    const dy = e.clientY - sy;
    const dt = Math.max(1, performance.now() - t0);

    // horizontal swipe only (no auto-scroll)
    if(Math.abs(dx) > 54 && Math.abs(dx) > Math.abs(dy)*1.35 && dt < 520){
      if(dx < 0) setMode("pro","swipe");
      else setMode("quick","swipe");
    }
  }, {passive:true});

  el.addEventListener("pointercancel", ()=>{ tracking=false; }, {passive:true});
})();
/* ===== Image Upload (adaptive compression for phones) ===== */
let IMG_MAX_FILES = 6;                 // will adapt by device
let IMG_MAX_EDGE  = 1280;              // max long edge
let IMG_QUALITY   = 0.72;              // jpeg/webp quality
let IMG_MAX_TOTAL_BYTES = 5.2 * 1024 * 1024; // ~5.2MB base64 payload safety
let IMG_OUT_MIME = "image/jpeg";

function bytesToHuman(n){
  if(n < 1024) return n + "B";
  if(n < 1024*1024) return (n/1024).toFixed(1) + "KB";
  return (n/(1024*1024)).toFixed(2) + "MB";
}

function pickPreferredMime(){
  const c = document.createElement("canvas");
  try{
    const ok = c.toDataURL("image/webp").startsWith("data:image/webp");
    return ok ? "image/webp" : "image/jpeg";
  }catch(_){
    return "image/jpeg";
  }
}

function computeImgProfile(){
  const isSmall = matchMedia("(max-width: 640px)").matches;
  const isTouch = matchMedia("(pointer: coarse)").matches;
  const mem = navigator.deviceMemory || 4;
  const conn = navigator.connection || null;
  const save = !!conn?.saveData;
  const eff = String(conn?.effectiveType || "");
  const slow = ["slow-2g","2g","3g"].includes(eff);

  // default (desktop / strong devices)
  let p = {
    maxFiles: 6,
    maxEdge: 1280,
    quality: 0.72,
    maxTotal: 5.2 * 1024 * 1024
  };

  // phones / weak devices / save-data
  if(isSmall || isTouch || mem <= 4 || save || slow){
    p = {
      maxFiles: 4,
      maxEdge: 1024,
      quality: 0.68,
      maxTotal: 3.6 * 1024 * 1024
    };
  }
  // very weak
  if(mem <= 2 || (isSmall && slow)){
    p = {
      maxFiles: 3,
      maxEdge: 900,
      quality: 0.64,
      maxTotal: 3.0 * 1024 * 1024
    };
  }
  return p;
}

function applyImgProfile(){
  const p = computeImgProfile();
  IMG_MAX_FILES = p.maxFiles;
  IMG_MAX_EDGE  = p.maxEdge;
  IMG_QUALITY   = p.quality;
  IMG_MAX_TOTAL_BYTES = p.maxTotal;
  IMG_OUT_MIME = pickPreferredMime();

  // update hint text in UI (language-aware)
  const L = I18N[state.lang || "ru"];
  const hint = (L.imgHint || "").replace("{n}", String(IMG_MAX_FILES));
  const el = $("imgHint");
  if(el) el.textContent = `${L.imgCaption} ${hint ? ("‚Ä¢ " + hint) : ""}`;
}


function renderThumbs(){
  const wrap = $("thumbs");
  if(!wrap) return;
  wrap.innerHTML = "";

  state.images.forEach((it, idx) => {
    const div = document.createElement("div");
    div.className = "thumb";
    div.innerHTML = `
      <img src="${it.data}" alt="upload ${idx+1}">
      <div class="meta">
        <span>${idx+1}/${state.images.length}</span>
        <span>${bytesToHuman(it.bytes)}</span>
        <span class="x" data-img-del="${idx}" title="–£–¥–∞–ª–∏—Ç—å">‚úï</span>
      </div>
    `;
    wrap.appendChild(div);
  });
}

document.addEventListener("click", (e)=>{
  const del = e.target.closest("[data-img-del]");
  if(!del) return;
  const idx = Number(del.getAttribute("data-img-del"));
  if(Number.isFinite(idx)){
    state.images.splice(idx, 1);
    renderThumbs();
    showToast(I18N[state.lang].toastImgRemoved);
  }
});

function openPicker(){
  $("imgInput")?.click();
}

$("btnImgPick")?.addEventListener("click", openPicker);

$("btnImgClear")?.addEventListener("click", ()=>{
  state.images = [];
  const inp = $("imgInput");
  if(inp) inp.value = "";
  renderThumbs();
  showToast(I18N[state.lang].toastImgCleared);
});

async function fileToCompressedDataURL(file){
  // —á–∏—Ç–∞–µ–º —Ñ–∞–π–ª -> —Ä–∏—Å—É–µ–º –≤ canvas -> —Å–∂–∏–º–∞–µ–º
  const bmp = await createImageBitmap(file).catch(()=>null);
  if(!bmp) throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ");

  const w = bmp.width, h = bmp.height;
  const scale = Math.min(1, IMG_MAX_EDGE / Math.max(w,h));
  const nw = Math.max(1, Math.round(w * scale));
  const nh = Math.max(1, Math.round(h * scale));

  const canvas = document.createElement("canvas");
  canvas.width = nw;
  canvas.height = nh;
  const ctx = canvas.getContext("2d", { alpha: false, desynchronized: true });

  // —á—É—Ç—å –ø–æ–≤—ã—à–∞–µ–º —Ä–µ–∑–∫–æ—Å—Ç—å —Ç–µ–∫—Å—Ç–∞ (—Å–∫—Ä–∏–Ω—à–æ—Ç—ã)
  ctx.imageSmoothingEnabled = true;
  ctx.imageSmoothingQuality = "high";
  ctx.drawImage(bmp, 0, 0, nw, nh);

  const data = canvas.toDataURL(IMG_OUT_MIME, IMG_QUALITY);
  return data;
}

function dataUrlBytes(dataUrl){
  // –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ base64
  const i = dataUrl.indexOf(",");
  if(i < 0) return 0;
  const b64 = dataUrl.slice(i+1);
  return Math.floor(b64.length * 0.75);
}


/* ===== Image Progress (fix: imgProgShow/imgProgHide) ===== */
let _imgProgRAF = 0;
let _imgProgTarget = 0;

function imgProgSet(pct){
  const box = $("imgProg");
  const fill = $("imgProgFill");
  const txt = $("imgProgPct");
  if(!box || !fill || !txt) return;

  const p = Math.max(0, Math.min(100, Number(pct) || 0));
  _imgProgTarget = p;

  if(!_imgProgRAF){
    const tick = ()=>{
      const cur = parseFloat(fill.style.width) || 0;
      const next = cur + (_imgProgTarget - cur) * 0.22;

      fill.style.width = next.toFixed(2) + "%";
      txt.textContent = Math.round(next) + "%";

      if(Math.abs(_imgProgTarget - next) < 0.6){
        fill.style.width = _imgProgTarget.toFixed(2) + "%";
        txt.textContent = Math.round(_imgProgTarget) + "%";
        _imgProgRAF = 0;
        return;
      }
      _imgProgRAF = requestAnimationFrame(tick);
    };
    _imgProgRAF = requestAnimationFrame(tick);
  }
}

function imgProgShow(){
  const box = $("imgProg");
  const t = $("imgProgTxt");
  if(!box) return;
  if(t) t.textContent = I18N[state.lang].imgProcessing;
  box.classList.add("show");
  box.setAttribute("aria-hidden","false");
  imgProgSet(8);
}

function imgProgHide(){
  const box = $("imgProg");
  if(!box) return;
  imgProgSet(100);
  setTimeout(()=>{
    box.classList.remove("show");
    box.setAttribute("aria-hidden","true");
    const fill = $("imgProgFill");
    const txt = $("imgProgPct");
    if(fill) fill.style.width = "0%";
    if(txt) txt.textContent = "0%";
    if(_imgProgRAF){ cancelAnimationFrame(_imgProgRAF); _imgProgRAF = 0; }
    _imgProgTarget = 0;
  }, 220);
}

/* ===== Drag & Drop upload ===== */
(function(){
  const box = $("imgBox");
  if(!box) return;

  const cls = "drag";
  const prevent = (e)=>{ e.preventDefault(); e.stopPropagation(); };

  ["dragenter","dragover"].forEach(ev=>{
    box.addEventListener(ev, (e)=>{
      prevent(e);
      box.classList.add(cls);
    });
  });

  ["dragleave","drop"].forEach(ev=>{
    box.addEventListener(ev, (e)=>{
      prevent(e);
      box.classList.remove(cls);
    });
  });

  box.addEventListener("drop", async (e)=>{
    const files = Array.from(e.dataTransfer?.files || []).filter(f=>/^image\//.test(f.type));
    if(!files.length) return;
    // –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç –∂–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫, —á—Ç–æ —É input
    const fakeEvent = { target: { files } };
    await (async()=>{ 
      // –≤—ã–∑–æ–≤–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ª–æ–≥–∏–∫—É —á–µ—Ä–µ–∑ manual-add
      const inp = $("imgInput");
      if(inp) inp.value = "";
      // –Ω–∏–∂–µ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ imgInput change ‚Äî –æ–Ω –æ–∂–∏–¥–∞–µ—Ç e.target.files
      // –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ—Å—Ç–æ –¥–µ—Ä–≥–∞–µ–º —Ç–æ—Ç –∂–µ –∫–æ–¥ –≤–Ω–∏–∑—É: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–µ–ª–∞–µ–º –∑–¥–µ—Å—å –ª–æ–∫–∞–ª—å–Ω–æ
      const remain = Math.max(0, IMG_MAX_COUNT - state.images.length);
      const take = files.slice(0, remain);
      if(!take.length){
        const L = I18N[state.lang];
        showToast((L.imgTooMany || "").replace("{n}", String(IMG_MAX_FILES)));
        return;
      }
      imgProgShow();
      try{
        let done = 0;
        const total = take.length;
        for(const f of take){
          imgProgSet(10 + (done/total)*80);
          const data = await fileToCompressedDataURL(f);
          const bytes = dataUrlBytes(data);
          state.images.push({ name: f.name || "image", mime: IMG_OUT_MIME, data, bytes });

          const totalBytes = state.images.reduce((s,x)=>s+x.bytes,0);
          if(totalBytes > IMG_MAX_TOTAL_BYTES){
            state.images.pop();
            showToast(I18N[state.lang].imgTooBig);
break;
          }
          done++;
          imgProgSet(10 + (done/total)*80);
        }
        renderThumbs();
        showToast(I18N[state.lang].toastImgDrop);
      }catch(err){
        alert((I18N[state.lang].imgErrPrefix) + (err.message || err));
}finally{
        imgProgHide();
      }
    })();
  });
})();


$("imgInput")?.addEventListener("change", async (e)=>{
  const files = Array.from(e.target.files || []);
  if(!files.length) return;

  const remain = Math.max(0, IMG_MAX_FILES - state.images.length);
  const take = files.slice(0, remain);

  if(!take.length){
    const L = I18N[state.lang];
        showToast((L.imgTooMany || "").replace("{n}", String(IMG_MAX_FILES)));
    return;
  }

  // –ª—ë–≥–∫–∞—è ‚Äú–∑–∞–≥—Ä—É–∑–∫–∞‚Äù
  imgProgShow();
  try{
    let done = 0;
    const totalN = take.length;

    for(const f of take){
      imgProgSet(10 + (done/totalN)*80);
      const data = await fileToCompressedDataURL(f);
      const bytes = dataUrlBytes(data);

      state.images.push({
        name: f.name || "image",
        mime: IMG_OUT_MIME,
        data,
        bytes
      });

      // –æ–±—â–∏–π –ª–∏–º–∏—Ç
      const total = state.images.reduce((s,x)=>s+x.bytes,0);
      if(total > IMG_MAX_TOTAL_BYTES){
        state.images.pop();
        showToast(I18N[state.lang].imgTooBig);
break;
      }

      done++;
      imgProgSet(10 + (done/totalN)*80);
    }
    renderThumbs();
    showToast(I18N[state.lang].toastImgDrop);
  }catch(err){
    alert((I18N[state.lang].imgErrPrefix) + (err.message || err));
}finally{
    imgProgHide()
  }
});


/* ===== Chips ===== */
document.addEventListener("click", (e)=>{
  const chip = e.target.closest("[data-chip]");
  if(!chip) return;
  const add = chip.getAttribute("data-chip");
  const ta = $("text");
  const v = ta.value.trim();
  ta.value = (v ? v + "\n" : "") + add;
  ta.focus();
  updateCharCount();
});

/* Ctrl+Enter */
document.addEventListener("keydown", (e)=>{
  if((e.ctrlKey || e.metaKey) && e.key === "Enter"){
    e.preventDefault();
    runAiCheckAndScroll();
  }
});

/* ===== FIXED 3D Tilt ===== */
function tiltBind(el){
  if(!el) return;

  const MAX_X = 8;
  const MAX_Y = 10;
  const EDGE = 10;
  const LEAVE_DELAY = 80;
  const SMOOTH = 0.16;

  let rect = null;
  let raf = 0;
  let mx = 0, my = 0;
  let active = false;
  let leaving = 0;

  let curRX = 0, curRY = 0;
  let tgtRX = 0, tgtRY = 0;

  function measure(){ rect = el.getBoundingClientRect(); }

  function renderTilt(){
    raf = 0;
    if(!active && Math.abs(curRX) < 0.05 && Math.abs(curRY) < 0.05){
      el.style.transform = `perspective(980px) rotateX(0deg) rotateY(0deg)`;
      el.style.setProperty("--mx", "50%");
      el.style.setProperty("--my", "50%");
      return;
    }

    curRX += (tgtRX - curRX) * SMOOTH;
    curRY += (tgtRY - curRY) * SMOOTH;

    el.style.transform = `perspective(980px) rotateX(${curRX.toFixed(2)}deg) rotateY(${curRY.toFixed(2)}deg)`;
    if(active && rect){
      const px = clamp01((mx - rect.left) / rect.width);
      const py = clamp01((my - rect.top) / rect.height);
      el.style.setProperty("--mx", (px * 100).toFixed(2) + "%");
      el.style.setProperty("--my", (py * 100).toFixed(2) + "%");
    }

    raf = requestAnimationFrame(renderTilt);
  }
  function requestRender(){ if(!raf) raf = requestAnimationFrame(renderTilt); }

  function setTargetFromPointer(){
    if(!rect) measure();
    const x = mx - rect.left;
    const y = my - rect.top;

    const near = (x < EDGE || y < EDGE || x > rect.width - EDGE || y > rect.height - EDGE);
    if(near){
      tgtRX *= 0.92;
      tgtRY *= 0.92;
      return;
    }

    const px = clamp01(x / rect.width);
    const py = clamp01(y / rect.height);

    tgtRX = (0.5 - py) * MAX_X;
    tgtRY = (px - 0.5) * MAX_Y;
  }

  el.addEventListener("pointerenter", (e)=>{
    clearTimeout(leaving);
    active = true;
    measure();
    mx = e.clientX; my = e.clientY;
    setTargetFromPointer();
    requestRender();
  });

  el.addEventListener("pointermove", (e)=>{
    if(!active) return;
    mx = e.clientX; my = e.clientY;
    setTargetFromPointer();
    requestRender();
  }, {passive:true});

  el.addEventListener("pointerleave", ()=>{
    clearTimeout(leaving);
    leaving = setTimeout(()=>{
      active = false;
      rect = null;
      tgtRX = 0; tgtRY = 0;
      requestRender();
    }, LEAVE_DELAY);
  });

  window.addEventListener("resize", ()=>{ if(active) measure(); }, {passive:true});
}

/* –í–ê–ñ–ù–û: –¢–í–û–ò –î–í–ï –°–¢–†–û–ö–ò –ù–ï –£–î–ê–õ–ï–ù–´ ‚Äî –¢–û–õ–¨–ö–û –°–î–ï–õ–ê–ù–´ –£–°–õ–û–í–ù–´–ú–ò –î–õ–Ø –ú–û–ë–ò–õ–´ */
if(!FG_IS_TOUCH) tiltBind($("leftCard"));
if(!FG_IS_TOUCH) tiltBind($("rightCard"));

/* ===== Spring accordion ===== */
function springTo(el, from, to){
  let x = from;
  let v = 0;
  const stiffness = 520;
  const damping = 34;
  let last = performance.now();

  function frame(now){
    const t = Math.min(0.032, (now - last)/1000);
    last = now;

    const steps = Math.max(1, Math.round(t / (1/60)));
    const h = t / steps;

    for(let i=0;i<steps;i++){
      const a = -stiffness * (x - to) - damping * v;
      v += a * h;
      x += v * h;
    }

    el.style.height = Math.max(0, x) + "px";
    const done = Math.abs(x - to) < 0.6 && Math.abs(v) < 0.6;

    if(!done) requestAnimationFrame(frame);
    else el.style.height = Math.round(to) + "px";
  }
  requestAnimationFrame(frame);
}

function setAccOpen(block, open){
  const wrap = block.querySelector(".accWrap");
  const inner = block.querySelector(".accInner");
  if(!wrap || !inner) return;

  const current = wrap.getBoundingClientRect().height;
  const target = open ? (inner.scrollHeight + 14) : 0;

  block.classList.toggle("open", open);
  springTo(wrap, current, target);
}

function initAccordion(){
  const ids = ["blkWhy","blkSafe","blkHL"];
  const blocks = ids.map(id=>$(id)).filter(Boolean);

  blocks.forEach(b=>{
    const wrap = b.querySelector(".accWrap");
    const inner = b.querySelector(".accInner");
    if(wrap && inner) wrap.style.height = (inner.scrollHeight + 14) + "px";
  });

  document.addEventListener("click",(e)=>{
    const head = e.target.closest("[data-acc]");
    if(!head) return;
    const id = head.getAttribute("data-acc");
    const block = $(id);
    if(!block) return;

    setAccOpen(block, !block.classList.contains("open"));
  });

  window.addEventListener("resize", ()=>{
    blocks.forEach(b=>{
      if(b.classList.contains("open")){
        const wrap = b.querySelector(".accWrap");
        const inner = b.querySelector(".accInner");
        if(wrap && inner) wrap.style.height = (inner.scrollHeight + 14) + "px";
      }
    });
  });
}
initAccordion();

/* ===== Timeout wrapper ===== */
async function fetchWithTimeout(url, opts={}, timeout=9000){
  const ctrl = new AbortController();
  const id = setTimeout(()=>ctrl.abort(), timeout);
  try{
    const res = await fetch(url, { ...opts, signal: ctrl.signal });
    clearTimeout(id);
    return res;
  }catch(e){
    clearTimeout(id);
    throw e;
  }
}

/* ===== Risk spring animation ===== */
const riskAnim = (() => {
  const fg = $("ringFg");
  const num = $("ringNum");
  const bar = $("barFill");
  const scoreText = $("scoreText");

  const r = 31;
  const C = 2 * Math.PI * r;

  let cur = 0;
  let vel = 0;
  let target = 0;
  let raf = 0;

  function setUI(val){
    const p = Math.max(0, Math.min(100, val));
    const dash = (C * (p/100));

    if(fg) fg.setAttribute("stroke-dasharray", `${dash.toFixed(2)} ${C.toFixed(2)}`);
    if(num) num.textContent = String(Math.round(p));
    if(scoreText) scoreText.textContent = `${Math.round(p)} / 100`;
    if(bar){
      bar.style.width = `${p.toFixed(1)}%`;
    }
  }

  function tick(){
    raf = 0;

    const stiffness = 360;
    const damping = 28;
    const dt = 1/60;

    // spring integrate
    const a = -stiffness * (cur - target) - damping * vel;
    vel += a * dt;
    cur += vel * dt;

    setUI(cur);

    const done = Math.abs(cur - target) < 0.08 && Math.abs(vel) < 0.08;
    if(!done) raf = requestAnimationFrame(tick);
    else {
      cur = target;
      vel = 0;
      setUI(cur);
    }
  }

  function animateTo(next){
    target = Math.max(0, Math.min(100, Number(next)||0));
    if(!raf) raf = requestAnimationFrame(tick);
  }

  function reset(){
    cur = 0; vel = 0; target = 0;
    setUI(0);
  }

  return { animateTo, reset, setColor: (color)=>{ if(fg) fg.setAttribute("stroke", color); if(bar) bar.style.background = color; } };
})();

/* ===== Scan highlight ===== */
function setScan(on){
  $("highlight").classList.toggle("scan", !!on);
}

function iconFor(reason){
  const s = (reason||"").toLowerCase();
  if(s.includes("–∫–æ–¥") || s.includes("–ø–∞—Ä–æ–ª") || s.includes("sms") || s.includes("—Å–º—Å")) return "üîë";
  if(s.includes("—Å—Å—ã–ª–∫–∞") || s.includes("–¥–æ–º–µ–Ω") || s.includes("url")) return "üîó";
  if(s.includes("—Å—Ä–æ—á") || s.includes("–Ω–µ–º–µ–¥") || s.includes("–≤ —Ç–µ—á–µ–Ω–∏–µ")) return "‚è±Ô∏è";
  if(s.includes("–ø–µ—Ä–µ–≤") || s.includes("–æ–ø–ª–∞—Ç") || s.includes("–¥–µ–Ω—å–≥")) return "üí∏";
  if(s.includes("–∏–Ω–≤–µ—Å—Ç") || s.includes("–¥–æ—Ö–æ–¥") || s.includes("–∫—Ä–∏–ø—Ç")) return "üìà";
  if(s.includes("—É–≥—Ä–æ–∑") || s.includes("—à–∞–Ω—Ç–∞–∂") || s.includes("–≤—ã–º–æ–≥")) return "üß®";
  return "‚ö†Ô∏è";
}

/* ===== Smart paste: extract URL from message ===== */
function extractFirstUrl(s){
  const m = String(s||"").match(/\bhttps?:\/\/[^\s<>"')]+/i);
  return m ? m[0] : "";
}
let urlToastLock = 0;
function smartExtractUrlFromText(){
  const text = $("text").value || "";
  const found = extractFirstUrl(text);
  if(found && !$("url").value.trim()){
    $("url").value = found;
    const now = Date.now();
    if(now - urlToastLock > 1400){
      urlToastLock = now;
      showToast(I18N[state.lang].toastLinkExtracted);
    }
  }
}

/* ===== char counter ===== */
function updateCharCount(){
  const n = ($("text").value || "").length;
  $("charCount").textContent = String(n);
}
$("text").addEventListener("input", ()=>{
  updateCharCount();
  smartExtractUrlFromText();
});
$("text").addEventListener("paste", ()=> setTimeout(()=>{
  updateCharCount();
  smartExtractUrlFromText();
}, 0));
updateCharCount();

/* ===== Loading bar driver ===== */
let loadRAF = 0;
let loadStart = 0;
let loadPct = 0;
function loadingStart(){
  $("loading").classList.add("show");
  $("loading").setAttribute("aria-hidden","false");
  loadStart = performance.now();
  loadPct = 0;
  $("loadingPct").textContent = "0";
  $("loadingFill").style.width = "0%";

  const tick = (t)=>{
    const dt = t - loadStart;
    // fake smooth progress: quickly rises, slows near 92%
    const cap = 92;
    const next = cap * (1 - Math.exp(-dt / 900));
    loadPct = Math.max(loadPct, next);
    $("loadingPct").textContent = String(Math.round(loadPct));
    $("loadingFill").style.width = `${loadPct.toFixed(1)}%`;
    loadRAF = requestAnimationFrame(tick);
  };
  loadRAF = requestAnimationFrame(tick);
}
function loadingFinish(){
  cancelAnimationFrame(loadRAF);
  loadRAF = 0;

  // snap to 100 smoothly
  $("loadingFill").style.width = "100%";
  $("loadingPct").textContent = "100";

  setTimeout(()=>{
    $("loading").classList.remove("show");
    $("loading").setAttribute("aria-hidden","true");
    // reset –Ω–µ–º–Ω–æ–≥–æ –ø–æ–∑–∂–µ, —á—Ç–æ–±—ã –Ω–µ –º–æ—Ä–≥–∞–ª–æ
    setTimeout(()=>{
      $("loadingFill").style.width = "0%";
      $("loadingPct").textContent = "0";
    }, 250);
  }, 220);
}

/* ===== RENDER (AI -> UI) ===== */
function render(data){
  if(!data) return;

  $("emptyState").style.display = "none";

  const scam = Number(data.risk ?? data.scam_score ?? data.risk_score ?? 0);
  const danger = Number(data.danger_score ?? 0);
/* === FORCE REAL RISK SCORE === */
const score = Math.max(
  0,
  Math.min(
    100,
    Math.round(
      Number(data.risk ?? data.scam_score ?? data.risk_score ?? 0)
    )
  )
);
  const color = riskColor(score);

/* === REAL CATEGORY FIX === */
let catKey;

if (score >= 70) {
  catKey = "riskHigh";
  $("categoryTag").querySelector(".miniDot").style.background = "var(--bad)";
}
else if (score >= 40) {
  catKey = "riskMedium";
  $("categoryTag").querySelector(".miniDot").style.background = "var(--warn)";
}
else {
  catKey = "riskLow";
  $("categoryTag").querySelector(".miniDot").style.background = "var(--good)";
}

$("catText").textContent = I18N[state.lang][catKey];

  // highlight risky words
  const text = $("text").value || "";
  const base = (state.lang==="ru")
    ? ["–∫–æ–¥","sms","—Å–º—Å","–ø–∞—Ä–æ–ª—å","cvv","cvc","–ø–µ—Ä–µ–≤–µ–¥–∏","–ø–µ—Ä–µ–≤–µ–¥–∏—Ç–µ","–æ–ø–ª–∞—Ç–∏","–æ–ø–ª–∞—Ç–∏—Ç–µ","—Å—Ä–æ—á–Ω–æ","–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ","–ø–æ–¥—Ç–≤–µ—Ä–¥","–≤–≤–µ–¥–∏—Ç–µ","–ª–æ–≥–∏–Ω","–∞–∫–∫–∞—É–Ω—Ç","–∫–∞—Ä—Ç–∞","–ø–∏–Ω","pin"]
    : ["code","sms","password","cvv","cvc","pay","transfer","urgent","immediately","verify","login","account","card","pin"];

  const fromReasons = reasons
    .join(" ")
    .split(/[\s,.;:!?()]+/g)
    .filter(w=>w && w.length>=4)
    .slice(0, 20);

  const badWords = Array.from(new Set([...base, ...fromReasons]));
  let out = escapeHTML(text);

  for(const w of badWords){
    const ww = String(w).replace(/[.*+?^${}()|[\]\\]/g,"\\$&");
    const re = new RegExp(ww, "gi");
    out = out.replace(re, m => `<mark>${escapeHTML(m)}</mark>`);
  }
  $("highlight").innerHTML = out || "‚Äî";

  ["blkWhy","blkSafe","blkHL"].forEach(id=>{
    const b = $(id);
    if(b && b.classList.contains("open")){
      const wrap = b.querySelector(".accWrap");
      const inner = b.querySelector(".accInner");
      if(wrap && inner) wrap.style.height = (inner.scrollHeight + 14) + "px";
    }
  });
}

/* ===== API call ===== */
async function runAiCheck(){
  const url = $("url").value.trim();
  const from = $("from") ? $("from").value.trim() : "";
  const text = $("text").value.trim();

const hasImgs = state.images && state.images.length > 0;

if(!text && !url && !hasImgs){
  alert(I18N[state.lang].alertNeed);
  return;
}

  loadingStart();
  setScan(true);
  $("btnCheck").disabled = true;

  try{
    let r;
    try{
      r = await fetchWithTimeout(API_URL, {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({
  url,
  from,
  text,
  images: state.images.map(x => ({
    name: x.name,
    mime: x.mime,
    data: x.data
  }))
})

      }, 9000);
    }catch(e){
      r = await fetchWithTimeout(API_URL, {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({
  url,
  from,
  text,
  images: state.images.map(x => ({
    name: x.name,
    mime: x.mime,
    data: x.data
  }))
})

      }, 9000);
    }

    const raw = await r.text();
    let data;
    try { data = JSON.parse(raw); }
    catch { throw new Error(I18N[state.lang].jsonErrPrefix + raw.slice(0,160)); }

    if(!r.ok || data?.ok === false){
      throw new Error(data?.details || data?.error || "API error");
    }

    render(data);
  }catch(e){
    alert(I18N[state.lang].alertErr + (e.message || "API error"));
  }finally{
    setScan(false);
    loadingFinish();
    $("btnCheck").disabled = false;
  }
}

/* Smooth scroll to result after AI check */
async function runAiCheckAndScroll(){
  await runAiCheck();
  $("rightCard")?.scrollIntoView({ behavior:"smooth", block:"start" });
}

/* ===== Typewriter for Demo (–ø–µ—á–∞—Ç–∞–µ—Ç –í–ï–ó–î–ï: from + url + text) ===== */
const demoType = (() => {
  let token = 0;
  let running = false;
  let last = { from:"", url:"", text:"" };

  function cancel(){ token++; running=false; }
  function isRunning(){ return running; }

  function finishInstant(){
    token++;
    running=false;
    if($("from")) $("from").value = last.from;
    $("url").value = last.url;
    $("text").value = last.text;
    updateCharCount();
    smartExtractUrlFromText();
    $("text").focus();
    try{ $("text").setSelectionRange($("text").value.length, $("text").value.length); }catch(_){}
  }

  async function typeField(el, fullText, opts={}){
    if(!el) return;
    const my = token;
    const cps = Math.max(12, Number(opts.cps ?? 62));
    const jitter = Math.max(0, Number(opts.jitter ?? 0.22));
    const baseDelay = 1000 / cps;

    el.value = "";
    el.focus();
    try{ el.setSelectionRange(0,0); }catch(_){}

    let i = 0;
    let lastT = performance.now();
    let acc = 0;

    while(i < fullText.length){
      if(my !== token){ return; }

      const now = performance.now();
      const dt = Math.min(64, now - lastT);
      lastT = now;
      acc += dt;

      let n = Math.floor(acc / baseDelay);
      if(n <= 0){ await new Promise(requestAnimationFrame); continue; }
      acc -= n * baseDelay;

      if(Math.random() < 0.28) n = Math.max(1, Math.min(n, 2));
      else n = Math.max(1, Math.min(n, 4));

      const chunk = fullText.slice(i, i+n);
      el.value += chunk;
      i += n;

      try{ el.setSelectionRange(el.value.length, el.value.length); }catch(_){}

      const lastChar = chunk.slice(-1);
      let extra = 0;
      if(lastChar === "\n") extra += 55 + Math.random()*85;
      if(lastChar === "." || lastChar === "!" || lastChar === "?") extra += 30 + Math.random()*70;
      if(lastChar === ":" || lastChar === ";") extra += 18 + Math.random()*42;

      const j = (Math.random() - 0.5) * 2 * jitter;
      extra += baseDelay * j * 6;

      if(extra > 0) await new Promise(r=>setTimeout(r, Math.min(220, extra)));
      else await new Promise(requestAnimationFrame);
    }
  }

  async function run(example){
    if(running) return;
    running = true;
    const my = ++token;

    last = { from: example.from, url: example.url, text: example.text };

    // In "–ë—ã—Å—Ç—Ä–æ" sender is hidden, so start typing where the user sees it instantly.
    const isPro = (document.body && document.body.dataset && document.body.dataset.mode === "pro");

    if(!isPro){
      // 1) message first (visible immediately)
      await typeField($("text"), example.text, { cps: 72, jitter: 0.22 });
      if(my !== token){ running=false; return; }

      // 2) set URL fast (no long waiting on hidden fields)
      if(!$("url").value.trim()){
        $("url").value = example.url;
      }else{
        await typeField($("url"), example.url, { cps: 74, jitter: 0.18 });
      }
    }else{
      if($("from")) await typeField($("from"), example.from, { cps: 58, jitter: 0.24 });
      if(my !== token){ running=false; return; }
      await typeField($("url"), example.url, { cps: 62, jitter: 0.22 });
      if(my !== token){ running=false; return; }
      await typeField($("text"), example.text, { cps: 66, jitter: 0.26 });
    }

    updateCharCount();
    smartExtractUrlFromText();
    running = false;
  }

  return { cancel, isRunning, finishInstant, run };
})();

/* Demo examples (—Ü–∏–∫–ª–∏—á–Ω–æ) */
const DEMOS = [
  {
    key:"bank",
    from: "[–¢–ï–°–¢] –°–ª—É–∂–±–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –±–∞–Ω–∫–∞ ‚Ä¢ –ó–∞—â–∏—Ç–∞",
    url: "https://bank-secure.example/verify",
    text:
"[–¢–ï–°–¢] –°–†–û–ß–ù–û: –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π –≤—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç.\n" +
"[–¢–ï–°–¢] –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ª–∏—á–Ω–æ—Å—Ç—å, –∏–Ω–∞—á–µ –¥–æ—Å—Ç—É–ø –±—É–¥–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω.\n" +
"[–¢–ï–°–¢] –ù–∏–∫–æ–º—É –Ω–µ —Å–æ–æ–±—â–∞–π—Ç–µ, –Ω–æ –≤–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ SMS –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è."
  },
  {
    key:"delivery",
    from: "[–¢–ï–°–¢] –î–æ—Å—Ç–∞–≤–∫–∞ ‚Ä¢ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞",
    url: "https://delivery-track.example/update",
    text:
"[–¢–ï–°–¢] –ü–æ—Å—ã–ª–∫–∞ –Ω–∞ —Å–∫–ª–∞–¥–µ: —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∞–¥—Ä–µ—Å.\n" +
"[–¢–ï–°–¢] –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –∏ –æ–ø–ª–∞—Ç–∏—Ç–µ 3,90 z≈Ç –∑–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ.\n" +
"[–¢–ï–°–¢] –ï—Å–ª–∏ –Ω–µ –æ–ø–ª–∞—Ç–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 2 —á–∞—Å–æ–≤ ‚Äî –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä–Ω—ë—Ç—Å—è."
  },
  {
    key:"invest",
    from: "[–¢–ï–°–¢] –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ ‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä",
    url: "https://profit-invest.example/start",
    text:
"[–¢–ï–°–¢] –í–∞–º –¥–æ—Å—Ç—É–ø–µ–Ω –¥–æ—Ö–æ–¥ +25% —É–∂–µ —Å–µ–≥–æ–¥–Ω—è.\n" +
"[–¢–ï–°–¢] –ù—É–∂–Ω–æ –≤–Ω–µ—Å—Ç–∏ –Ω–µ–±–æ–ª—å—à–æ–π –¥–µ–ø–æ–∑–∏—Ç –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∫–∞—Ä—Ç—É.\n" +
"[–¢–ï–°–¢] –ù–∞–ø–∏—à–∏—Ç–µ ¬´–î–ê¬ª, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –∏ —Å—Å—ã–ª–∫—É."
  }
];
let demoIdx = 0;

/* Buttons */
$("btnCheck").onclick = runAiCheckAndScroll;

$("btnClear").onclick = ()=>{
  demoType.cancel();

  $("url").value="";
  if($("from")) $("from").value="";
  $("text").value="";
  updateCharCount();

  $("emptyState").style.display = "grid";
  $("highlight").textContent="‚Äî";
  $("reasons").textContent="‚Äî";
  $("safe").textContent="‚Äî";

  riskAnim.reset();

  $("catText").textContent="‚Äî";
  $("categoryTag").querySelector(".miniDot").style.background = "rgba(255,255,255,.35)";
  $("barFill").style.width="0%";

  showToast(I18N[state.lang].toastCleared);
};

$("btnDemo").onclick = async ()=>{
  if(demoType.isRunning()){
    demoType.finishInstant();
    showToast(I18N[state.lang].toastExample);
    return;
  }
  const ex = DEMOS[demoIdx % DEMOS.length];
  demoIdx++;
  await demoType.run(ex);
  showToast(I18N[state.lang].toastExample);
};

/* Language init */
(function initLang(){
  const sel = $("lang");
  const saved = localStorage.getItem("fg_lang");
  const start = (saved === "en" || saved === "ru") ? saved : "ru";
  applyLang(start);
  if(sel){
    sel.value = start;
    sel.addEventListener("change", ()=>{
      const v = sel.value === "en" ? "en" : "ru";
      localStorage.setItem("fg_lang", v);
      applyLang(v);
    });
  }
})();

// ===== HARD MODE FIX (Quick vs Pro) =====
(function(){
  const tabQuick = document.getElementById("tabQuick");
  const tabPro   = document.getElementById("tabPro");
  const proWrap  = document.getElementById("proWrap");
  const tabsBox  = document.getElementById("modeTabs");
  const modeAnim = document.getElementById("modeAnim");

  function setMode(isPro){
    tabQuick.classList.toggle("active", !isPro);
    tabPro.classList.toggle("active", isPro);
    tabsBox && tabsBox.style.setProperty("--i", isPro ? 1 : 0);

    if(proWrap){
      if(isPro){
        proWrap.classList.add("show");
        proWrap.removeAttribute("aria-hidden");
      }else{
        proWrap.classList.remove("show");
        proWrap.setAttribute("aria-hidden","true");
      }
    }

    if(modeAnim){
      modeAnim.dataset.swap = isPro ? "toPro" : "toQuick";
      modeAnim.classList.remove("swap");
      void modeAnim.offsetWidth;
      modeAnim.classList.add("swap");
    }
  }

  tabQuick && tabQuick.addEventListener("click", ()=>setMode(false));
  tabPro   && tabPro.addEventListener("click", ()=>setMode(true));

  setMode(false);
})();


// ===== FG MODE CONTROLLER (robust override) =====
(function(){
  const $$ = (id)=>document.getElementById(id);
  const tabsBox = $$("modeTabs");
  const modeAnim = $$("modeAnim");
  const proWrap = $$("proWrap");

  function rebindButton(id){
    const b = $$(id);
    if(!b) return null;
    const clone = b.cloneNode(true);
    b.parentNode.replaceChild(clone, b);
    return clone;
  }

  let tabQuick = rebindButton("tabQuick");
  let tabPro   = rebindButton("tabPro");

  function setTabTexts(){
    try{
      const langSel = $$("lang");
      const lang = (langSel && langSel.value) || (window.state && window.state.lang) || document.documentElement.lang || "ru";
      const dict = (window.I18N && window.I18N[lang]) ? window.I18N[lang] : (window.I18N && window.I18N.ru) || null;
      if(dict){
        if(tabQuick) tabQuick.textContent = dict.tabQuick || tabQuick.textContent;
        if(tabPro)   tabPro.textContent   = dict.tabPro   || tabPro.textContent;
      }
    }catch(e){}
  }

  function setMode(isPro){
    document.body.dataset.mode = isPro ? "pro" : "quick";

    if(tabQuick) tabQuick.classList.toggle("active", !isPro);
    if(tabPro)   tabPro.classList.toggle("active", isPro);

    // move indicator
    if(tabsBox) tabsBox.style.setProperty("--i", isPro ? 1 : 0);

    // sender field: hard hide/show + animated open in pro
    if(proWrap){
      if(isPro){
        proWrap.style.display = "block";
        requestAnimationFrame(()=>{
          proWrap.classList.add("show");
          proWrap.removeAttribute("aria-hidden");
        });
      }else{
        proWrap.classList.remove("show");
        proWrap.setAttribute("aria-hidden","true");
        proWrap.style.display = "none";
      }
    }

    // WOW swap anim
    if(modeAnim){
      modeAnim.dataset.swap = isPro ? "toPro" : "toQuick";
      modeAnim.classList.remove("swap");
      void modeAnim.offsetWidth;
      modeAnim.classList.add("swap");
    }

    setTabTexts();
  }

  function init(){
    // ensure correct RU labels by default
    setTabTexts();

    // click handlers
    tabQuick && tabQuick.addEventListener("click", ()=>setMode(false));
    tabPro   && tabPro.addEventListener("click", ()=>setMode(true));

    // react to language changes
    const langSel = $$("lang");
    langSel && langSel.addEventListener("change", ()=>setTabTexts());

    // default = quick
    setMode(false);
  }

  if(document.readyState === "loading") document.addEventListener("DOMContentLoaded", init);
  else init();
})();


// ===== BEAUTIFUL FIELD LOADING =====
function setFieldLoading(on){
  const ids = ["url","text","from"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    if(on){
      el.classList.add("input-loading");
      el.setAttribute("aria-busy","true");
    }else{
      el.classList.remove("input-loading");
      el.removeAttribute("aria-busy");
    }
  });
}

// hook into loading overlay if exists
(function(){
  const _show = window.showLoading;
  const _hide = window.hideLoading;
  if(typeof _show === "function"){
    window.showLoading = function(){
      setFieldLoading(true);
      return _show.apply(this, arguments);
    }
  }
  if(typeof _hide === "function"){
    window.hideLoading = function(){
      setFieldLoading(false);
      return _hide.apply(this, arguments);
    }
  }
})();

</script>
</body>
</html>
