<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>FraudGuard ‚Äî Anti-Scam</title>

<link rel="icon" href="./favicon.ico?v=10008">
<link rel="apple-touch-icon" href="./apple-touch-icon.png?v=10008">
<meta name="theme-color" content="#070c18">

<style>
:root{
  --bg0:#04060f;
  --bg2:#0b1220;

  --text:#eef3ff;
  --muted:#a9b7d8;
  --muted2:#7f95be;

  --line:rgba(255,255,255,10);

  --good:#2ee59d;
  --warn:#ffcc66;
  --bad:#ff5c7a;
  --accent:#6aa6ff;

  --shadow: 0 22px 100px rgba(0,0,0,48);
  --shadow2: 0 14px 70px rgba(0,0,0,30);
  --r2:26px;

  --spring: cubic-bezier(.16,1,3,1);

  --glass: rgba(255,255,255,06);
  --glass2: rgba(255,255,255,035);
  --stroke: rgba(255,255,255,12);

  --tabsRad: 20px;
  --tabsPad: 8px;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
  color:var(--text);
  background: linear-gradient(180deg, var(--bg0), var(--bg2));
  overflow-x:hidden;
  letter-spacing:.1px;
}
::selection{background:rgba(106,166,255,35)}

@media (prefers-reduced-motion: reduce){
  *{ animation:none !important; transition:none !important; }
}

/* ===== Fluid background (moving) ===== */
.fluid{
  position:fixed; inset:-8%;
  z-index:-6;
  pointer-events:none;
  opacity:.70;
  filter: blur(8px) saturate(1.15);
  transform: translateZ(0);
}
.fluid svg{ width:100%; height:100%; display:block; }
.fluid .vignette{
  position:absolute; inset:0;
  background:
    radial-gradient(900px 520px at 15% 10%, rgba(106,166,255,18), transparent 60%),
    radial-gradient(900px 520px at 85% 12%, rgba(46,229,157,12), transparent 62%),
    radial-gradient(1100px 760px at 45% 95%, rgba(255,92,122,10), transparent 60%),
    radial-gradient(1200px 900px at 50% 50%, transparent 45%, rgba(0,0,0,55) 85%),
    linear-gradient(180deg, rgba(4,6,15,85), rgba(11,18,32,90));
  mix-blend-mode: overlay;
  pointer-events:none;
}

/* subtle noise */
.noise{
  position:fixed; inset:0; z-index:-2; pointer-events:none;
  opacity:.07;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='280' height='280'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='280' height='280' filter='url(%23n)' opacity='.4'/%3E%3C/svg%3E");
  mix-blend-mode: overlay;
}

/* ===== WIDE LAYOUT ===== */
.wrap{
  max-width: 1240px;
  margin: 0 auto;
  padding: 22px 18px 44px;
  position:relative;
  z-index:1;
}

/* topbar */
.topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:14px;
  margin-bottom:16px;

  max-width:1240px;
  margin-left:auto;
  margin-right:auto;
  padding: 10px 2px;
}
.brand{ display:flex; align-items:center; gap:12px; }
.logo{
  width:44px; height:44px; border-radius:16px;
  background: linear-gradient(135deg, rgba(106,166,255,1), rgba(46,229,157,1));
  display:grid; place-items:center;
  color:#061023; font-weight:950;
  box-shadow: 0 18px 65px rgba(0,0,0,35);
  animation: popLogo .7s var(--spring) both;
}
@keyframes popLogo{ from{transform:translateY(8px) scale(.92);opacity:0} to{transform:translateY(0) scale(1);opacity:1} }
.brand h1{ margin:0; font-size:16px; letter-spacing:.3px; line-height:1.1; }
.brand .sub{ margin-top:2px; font-size:12px; color: var(--muted2); }

.badges{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-end; }
.pill{
  display:inline-flex; align-items:center; gap:8px;
  padding:8px 12px; border-radius:999px;
  border:1px solid var(--line); background: rgba(255,255,255,05);
  font-size:12px; backdrop-filter: blur(10px);
  animation: fadeIn .7s var(--spring) both;
}
.pill:nth-child(2){ animation-delay:.06s; }
@keyframes fadeIn{ from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:translateY(0)} }
.pill .dot{ width:8px; height:8px; border-radius:999px; background: var(--accent); box-shadow: 0 0 0 6px rgba(106,166,255,10); }
.pill .kbd{ padding:2px 8px; border-radius:10px; border:1px solid rgba(255,255,255,14); background: rgba(0,0,0,25); font-size:12px; }

/* language switch */
.langSel{
  display:inline-flex; align-items:center; gap:8px;
  padding:8px 12px; border-radius:999px;
  border:1px solid var(--line); background: rgba(255,255,255,05);
  font-size:12px; backdrop-filter: blur(10px);
  animation: fadeIn .7s var(--spring) both;
}
.langSel select{
  background: transparent;
  border:none;
  color: var(--text);
  outline:none;
  font-size:12px;
}

/* cards */
.grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:18px;
}
.card{
  position:relative;
  border-radius: 26px;
  background: rgba(255,255,255,03);
  border:1px solid rgba(255,255,255,12);
  padding: 18px;
  box-shadow: var(--shadow);
  backdrop-filter: blur(18px);
  transform-style: preserve-3d;
  animation: pop .6s var(--spring) both;
}
@keyframes pop{ from{opacity:0;transform:translateY(12px) scale(.985)} to{opacity:1;transform:translateY(0) scale(1)} }
.card:hover{ box-shadow: 0 34px 140px rgba(0,0,0,62); }

.card::before{
  content:"";
  position:absolute; inset:-1px;
  pointer-events:none;
  background:
    radial-gradient(900px 260px at 18% 0%, rgba(106,166,255,12), transparent 62%),
    radial-gradient(900px 260px at 82% 0%, rgba(46,229,157,10), transparent 62%);
  opacity: .95;
}
.card > *{ position:relative; transform: translateZ(0.01px); }

.card.tilt::after{
  content:"";
  position:absolute; inset:-1px;
  pointer-events:none;
  border-radius: inherit;
  background: radial-gradient(520px 320px at var(--mx) var(--my),
    rgba(255,255,255,012),
    rgba(106,166,255,008) 25%,
    rgba(46,229,157,006) 45%,
    transparent 66%);
  opacity:0;
  transition: opacity .18s ease;
  mix-blend-mode: screen;
}
.card.tilt:hover::after{ opacity:.10; }

.depth-1{ transform: translateZ(16px); }
.depth-2{ transform: translateZ(24px); }

.header-row{ display:flex; align-items:flex-end; justify-content:space-between; gap:12px; margin-bottom:12px; }
.title{ font-weight:950; font-size:18px; letter-spacing:.2px; }
.caption{ font-size:12.5px; color: var(--muted2); margin-top:4px; line-height:1.35; }

/* ===== Tabs (PREMIUM + FIXED ‚Äú—Å–ª–∏–ø–∞–Ω–∏–µ‚Äù) ===== */
.tabs{
  --i: 0;
  position:relative;
  display:flex;
  gap:10px;
  padding: var(--tabsPad);
  border-radius: var(--tabsRad);
  border:1px solid rgba(255,255,255,12);
  background: rgba(255,255,255,035);
  overflow:hidden;
  transform: translateZ(24px);
  align-items:stretch;
  min-height:48px;
  box-shadow: 0 12px 50px rgba(0,0,0,22);
  isolation:isolate;
}
.tabs::before{
  content:"";
  position:absolute; inset:0;
  pointer-events:none;
  background:
    radial-gradient(900px 240px at 18% 0%, rgba(106,166,255,10), transparent 64%),
    radial-gradient(900px 240px at 82% 0%, rgba(46,229,157,08), transparent 64%);
  opacity:.9;
  z-index:0;
}
.tab-ind{
  position:absolute;
  left: var(--tabsPad);
  top: var(--tabsPad);
  bottom: var(--tabsPad);
  width: calc(50% - (var(--tabsPad) * .5) - 5px);
  border-radius: calc(var(--tabsRad) - 6px);
  background: rgba(255,255,255,10);
  border:1px solid rgba(255,255,255,16);
  transform: translateX(calc(var(--i) * (100% + 10px)));
  transition: transform .62s var(--spring);
  box-shadow: 0 16px 40px rgba(0,0,0,28);
  z-index:1;
  overflow:hidden;
}
.tab-ind::after{
  content:"";
  position:absolute; inset:-30% -40%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,16), transparent);
  transform: translateX(-70%) rotate(10deg);
  opacity:.8;
  animation: tabsSheen 1.25s ease-in-out infinite;
}
@keyframes tabsSheen{
  0%{ transform: translateX(-70%) rotate(10deg); opacity:.25; }
  55%{ opacity:.55; }
  100%{ transform: translateX(70%) rotate(10deg); opacity:.25; }
}
.tab{
  position:relative;
  flex:1;
  padding: 11px 12px;
  border-radius: calc(var(--tabsRad) - 6px);
  border:1px solid transparent;
  background: transparent;
  color: rgba(231,238,255,72);
  font-size: 13px;
  font-weight: 950;
  cursor:pointer;
  white-space: nowrap;
  display:flex;
  align-items:center;
  justify-content:center;
  transition: transform .22s var(--spring), color .22s ease, filter .22s ease;
  z-index:2;
}
.tab:hover{ transform: translateY(-1px) scale(1.01); filter: brightness(1.07); }
.tab:active{ transform: translateY(0) scale(.99); }
.tab.active{
  color: var(--text);
  text-shadow: 0 10px 30px rgba(0,0,0,35);
}

/* ‚Äú–∫–ª–∞—Å—Å–Ω–∞—è‚Äù –∞–Ω–∏–º–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ */
.modeAnim{
  position:relative;
}
.modeAnim.swap{
  animation: modeSwap .62s var(--spring);
}
@keyframes modeSwap{
  0%{ transform: translateY(0) scale(1); filter: blur(0); }
  40%{ transform: translateY(-4px) scale(.994); filter: blur(.6px); }
  100%{ transform: translateY(0) scale(1); filter: blur(0); }
}

/* pro fields */
.proWrap{
  overflow:hidden;
  max-height: 0px;
  opacity: 0;
  transform: translateY(-10px) scale(.985);
  filter: blur(8px);
  transition: max-height .62s var(--spring), opacity .40s ease, transform .62s var(--spring), filter .40s ease;
  will-change: max-height, transform, opacity, filter;
}
.proWrap.show{
  max-height: 140px;
  opacity: 1;
  transform: translateY(0) scale(1);
  filter: blur(0);
}

/* inputs */
.label{ font-size:12px; color: var(--muted2); margin: 12px 0 6px; }
input, textarea{
  width:100%;
  background: rgba(8,12,22,72);
  border:1px solid rgba(255,255,255,14);
  border-radius: 16px;
  padding: 12px 12px;
  color: var(--text);
  outline:none;
  transition: box-shadow .2s var(--spring), border-color .2s ease, transform .18s var(--spring), filter .18s ease;
}
textarea{ min-height: 158px; resize: vertical; line-height: 1.45; }
input::placeholder, textarea::placeholder{ color: rgba(159,177,209,62); }
input:focus, textarea:focus{
  border-color: rgba(106,166,255,65);
  box-shadow: 0 0 0 4px rgba(106,166,255,12), 0 18px 55px rgba(0,0,0,20);
  transform: translateY(-1px);
  filter: brightness(1.02);
}

/* helper row */
.helperRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-top:8px;
  color: var(--muted2);
  font-size: 12px;
}
.counter{
  display:inline-flex; align-items:center; gap:8px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,12);
  background: rgba(255,255,255,04);
}
.counter b{ color: rgba(231,238,255,92); font-weight:950; }

/* chips */
.chips{ display:flex; gap:8px; flex-wrap:wrap; margin-top:12px; }
.chip{
  border:1px solid rgba(255,255,255,12);
  background: rgba(255,255,255,05);
  color: rgba(231,238,255,90);
  padding: 7px 12px;
  border-radius: 999px;
  font-size: 12px;
  cursor:pointer;
  transition: transform .18s var(--spring), box-shadow .2s ease, filter .2s ease;
}
.chip:hover{ transform: translateY(-2px) scale(1.02); box-shadow: var(--shadow2); filter: brightness(1.06); }
.chip:active{ transform: translateY(0) scale(.985); }

/* toast */
#toast{
  position:fixed;
  left: 50%;
  bottom: 18px;
  transform: translateX(-50%) translateY(14px);
  min-width: min(520px, 92vw);
  max-width: min(720px, 92vw);
  padding: 12px 14px;
  border-radius: 18px;
  border:1px solid rgba(255,255,255,14);
  background: rgba(10,16,30,72);
  backdrop-filter: blur(14px);
  box-shadow: 0 22px 90px rgba(0,0,0,55);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  opacity:0;
  pointer-events:none;
  transition: opacity .22s ease, transform .32s var(--spring);
  z-index: 10000;
}
#toast.show{
  opacity:1;
  pointer-events:auto;
  transform: translateX(-50%) translateY(0);
}
#toast .t{
  font-size:13px;
  color: rgba(231,238,255,92);
  line-height:1.35;
}
#toast .x{
  width:40px;height:40px;
  border-radius:14px;
  display:grid;place-items:center;
  border:1px solid rgba(255,255,255,14);
  background: rgba(255,255,255,06);
  cursor:pointer;
  user-select:none;
}
#toast .x:hover{ filter: brightness(1.06); }

/* buttons + ripple */
.actions{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:14px; }
.btn{
  position:relative;
  display:inline-flex; align-items:center; justify-content:center;
  gap:10px;
  border:1px solid rgba(255,255,255,14);
  background: rgba(255,255,255,06);
  color: var(--text);
  padding: 10px 14px;
  border-radius: 16px;
  min-height:44px;
  cursor:pointer;
  transition: transform .18s var(--spring), box-shadow .22s ease, filter .18s ease;
  overflow:hidden;
  user-select:none;
}
.btn:hover{ transform: translateY(-2px); box-shadow: 0 14px 55px rgba(0,0,0,28); filter: brightness(1.06); }
.btn:active{ transform: translateY(0) scale(.985); }
.btn:disabled{ opacity:.6; cursor:not-allowed; transform:none !important; box-shadow:none !important; }

.btn::before{
  content:"";
  position:absolute; inset:-30% -60%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,12), transparent);
  transform: translateX(-60%) rotate(10deg);
  opacity:0;
}
.btn:hover::before{
  opacity:1;
  animation: sheen 1.2s ease-in-out infinite;
}
@keyframes sheen{
  0%{ transform: translateX(-65%) rotate(10deg); }
  100%{ transform: translateX(65%) rotate(10deg); }
}

.btn .ic{
  width:18px; height:18px; display:inline-block;
  filter: drop-shadow(0 6px 20px rgba(0,0,0,25));
}
.btn.primary{
  border:none;
  background: linear-gradient(135deg, var(--accent), var(--good));
  color:#061023;
  font-weight: 950;
}
.btn.ghost{ background: rgba(0,0,0,22); }

.ripple{
  position:absolute;
  border-radius:999px;
  transform: scale(0);
  opacity: .6;
  pointer-events:none;
  background: rgba(255,255,255,22);
  animation: ripple .55s ease-out forwards;
}
@keyframes ripple{ to{ transform: scale(1); opacity:0; } }

/* note */
.note{
  display:flex; gap:10px; align-items:flex-start;
  margin-top: 14px; padding: 12px;
  border-radius: 18px;
  border:1px solid rgba(255,204,102,16);
  background: rgba(255,204,102,06);
  color: rgba(255,232,190,95);
  font-size: 12px; line-height:1.4;
  transition: transform .2s var(--spring), filter .2s ease;
}

/* ===== Loading overlay (BAR instead of spinner) ===== */
#loading{
  position:fixed; inset:0;
  display:grid;
  place-items:center;
  padding:18px;
  background: rgba(2,6,14,72);
  backdrop-filter: blur(10px);
  z-index: 9999;
  opacity:0;
  pointer-events:none;
  transition: opacity .22s ease;
}
#loading.show{ opacity:1; pointer-events:auto; }

.loading-box{
  width: min(620px, 92vw);
  background: rgba(15,27,51,92);
  border:1px solid rgba(255,255,255,14);
  border-radius: 22px;
  padding: 18px 18px 16px;
  box-shadow: var(--shadow);
  animation: pop .35s var(--spring) both;
  position:relative;
  overflow:hidden;
}
@keyframes pop{ from{transform:translateY(10px) scale(.98);opacity:0} to{transform:translateY(0) scale(1);opacity:1} }

.loading-top{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:14px;
}
.loading-title{
  font-weight:950;
}
.loading-sub{
  margin-top:4px;
  color: var(--muted2);
  font-size:12.5px;
  line-height:1.35;
}
.loading-pct{
  font-weight:950;
  font-size: 13px;
  color: rgba(231,238,255,90);
  padding: 6px 10px;
  border-radius: 999px;
  border:1px solid rgba(255,255,255,14);
  background: rgba(255,255,255,05);
  white-space:nowrap;
}

.loading-bar{
  margin-top: 14px;
  height: 12px;
  border-radius: 999px;
  border:1px solid rgba(255,255,255,14);
  background: rgba(255,255,255,06);
  overflow:hidden;
  position:relative;
}
.loading-fill{
  height:100%;
  width: 0%;
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(106,166,255,95), rgba(46,229,157,95));
  transition: width .22s var(--spring);
  position:relative;
}
.loading-fill::after{
  content:"";
  position:absolute; inset:-30% -40%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,22), transparent);
  transform: translateX(-70%) rotate(12deg);
  opacity:.85;
  animation: loadSheen 1.05s ease-in-out infinite;
  mix-blend-mode: screen;
}
@keyframes loadSheen{
  0%{ transform: translateX(-70%) rotate(12deg); opacity:.25; }
  55%{ opacity:.55; }
  100%{ transform: translateX(70%) rotate(12deg); opacity:.25; }
}

/* show logo ONLY in topbar (kills left duplicate if exists) */
.logo{ display:none !important; }
.topbar .logo{ display:grid !important; }

/* ===== MOBILE PERF PATCH (NON-DESTRUCTIVE) ===== */
@media (pointer: coarse), (max-width: 980px){
  .fluid{
    filter: blur(4px) saturate(1.05);
    opacity:.45;
  }

  .card{
    backdrop-filter: blur(8px);
  }

  .tabs{
    transform: none;
  }

  .tab-ind::after,
  .loading-fill::after{
    animation: none;
  }

  .card::before,
  .card.tilt::after{
    opacity:.04;
  }
}

/* ===== UI LOAD FADE-IN PATCH ===== */
body:not(.ui-ready) .fluid{
  opacity: 0;
}
</style>
</head>
<body>

<!-- Fluid background -->
<div class="fluid" aria-hidden="true">
  <svg viewBox="0 0 1200 800" preserveAspectRatio="none">
    <defs>
      <filter id="turb">
        <feTurbulence type="fractalNoise" baseFrequency="0.012" numOctaves="2" seed="8" result="noise">
          <animate attributeName="baseFrequency" dur="10s" values="0.010;0.016;0.012" repeatCount="indefinite"/>
          <animate attributeName="seed" dur="14s" values="8;12;8" repeatCount="indefinite"/>
        </feTurbulence>
        <feDisplacementMap in="SourceGraphic" in2="noise" scale="42" xChannelSelector="R" yChannelSelector="G"/>
        <feGaussianBlur stdDeviation="0.4"/>
      </filter>

      <radialGradient id="g1" cx="30%" cy="25%" r="70%">
        <stop offset="0%" stop-color="rgba(106,166,255,55)"/>
        <stop offset="55%" stop-color="rgba(106,166,255,12)"/>
        <stop offset="100%" stop-color="rgba(0,0,0,0)"/>
      </radialGradient>
      <radialGradient id="g2" cx="70%" cy="28%" r="70%">
        <stop offset="0%" stop-color="rgba(46,229,157,45)"/>
        <stop offset="60%" stop-color="rgba(46,229,157,10)"/>
        <stop offset="100%" stop-color="rgba(0,0,0,0)"/>
      </radialGradient>
      <radialGradient id="g3" cx="50%" cy="80%" r="80%">
        <stop offset="0%" stop-color="rgba(255,92,122,30)"/>
        <stop offset="65%" stop-color="rgba(255,92,122,08)"/>
        <stop offset="100%" stop-color="rgba(0,0,0,0)"/>
      </radialGradient>
    </defs>

    <g filter="url(#turb)" opacity="0.95">
      <rect x="-100" y="-100" width="1400" height="1000" fill="rgba(6,10,20,1)"/>
      <ellipse cx="260" cy="220" rx="520" ry="360" fill="url(#g1)"/>
      <ellipse cx="920" cy="240" rx="560" ry="380" fill="url(#g2)"/>
      <ellipse cx="620" cy="690" rx="760" ry="460" fill="url(#g3)"/>
    </g>
  </svg>
  <div class="vignette"></div>
</div>

<div class="noise"></div>

<div class="wrap">
  <div class="topbar">
    <div class="brand">
      <div class="logo">FG</div>
      <div>
        <h1>FraudGuard</h1>
        <div class="sub">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —Å—Å—ã–ª–æ–∫ –Ω–∞ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ</div>
      </div>
    </div>

    <div class="badges">
      <div class="pill">
        <span class="dot"></span>
        <span id="pillAI">AI-–∞–Ω–∞–ª–∏–∑</span>
      </div>
      <div class="pill">
        <span id="pillHotkeys">–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏:</span>
        <span class="kbd">Ctrl</span> + <span class="kbd">Enter</span>
      </div>
      <div class="langSel">
        <span id="langLabel">–Ø–∑—ã–∫</span>
        <select id="lang">
          <option value="ru">RU</option>
          <option value="en">EN</option>
        </select>
      </div>
    </div>
  </div>

  <div class="grid">
    <div class="card tilt depth-2" id="leftCard">
      <div class="header-row">
        <div>
          <div class="title" id="checkTitle">–ü—Ä–æ–≤–µ—Ä–∫–∞</div>
          <div class="caption" id="checkCaption">–í—Å—Ç–∞–≤—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∏/–∏–ª–∏ —Å—Å—ã–ª–∫—É ‚Äî –ø–æ–ª—É—á–∏—à—å —Å–∫–æ—Ä, –ø—Ä–∏—á–∏–Ω—ã –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</div>
        </div>
      </div>

      <div class="tabs" id="tabs">
        <div class="tab-ind" id="tabInd"></div>
        <button class="tab active" data-mode="quick" id="tabQuick">–ë—ã—Å—Ç—Ä–æ</button>
        <button class="tab" data-mode="pro" id="tabPro">–ü–æ–¥—Ä–æ–±–Ω–æ</button>
      </div>

      <div class="modeAnim" id="modeAnim">

        <div class="quickWrap">
          <div class="label" id="textLabel">–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è</div>
          <textarea id="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–±–µ—Ä–±–∞–Ω–∫: –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –≤—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ..."></textarea>

          <div class="helperRow">
            <div class="counter"><b id="charCount">0</b> —Å–∏–º–≤–æ–ª–æ–≤</div>
            <div class="chips">
              <div class="chip" data-demo="bank">–ë–∞–Ω–∫</div>
              <div class="chip" data-demo="delivery">–î–æ—Å—Ç–∞–≤–∫–∞</div>
              <div class="chip" data-demo="invest">–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</div>
              <div class="chip" data-demo="job">–†–∞–±–æ—Ç–∞</div>
            </div>
          </div>
        </div>

        <div class="proWrap" id="proWrap">
          <div class="label" id="urlLabel">–°—Å—ã–ª–∫–∞ (–æ–ø—Ü.)</div>
          <input id="url" placeholder="https://example.com/login">

          <div class="label" id="fromLabel">–û—Ç –∫–æ–≥–æ –ø—Ä–∏—à–ª–æ (–æ–ø—Ü.)</div>
          <input id="from" placeholder="Sberbank">
        </div>

        <div class="actions">
          <button class="btn primary" id="btnCheck">
            <span class="ic">üîç</span>
            <span id="btnCheckTxt">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</span>
          </button>
          <button class="btn ghost" id="btnClear">
            <span class="ic">‚úï</span>
            <span id="btnClearTxt">–û—á–∏—Å—Ç–∏—Ç—å</span>
          </button>
          <button class="btn ghost" id="btnDemo">
            <span class="ic">‚ö°</span>
            <span id="btnDemoTxt">–ü—Ä–∏–º–µ—Ä</span>
          </button>
        </div>

        <div class="note" id="note">
          <div>‚ö†Ô∏è</div>
          <div id="noteTxt">–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–≤–æ–¥–∏ –∫–æ–¥—ã –∏ –ø–∞—Ä–æ–ª–∏ –ø–æ —Å—Å—ã–ª–∫–∞–º –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π</div>
        </div>

      </div>
    </div>

    <div class="card tilt depth-2" id="rightCard">
      <div class="header-row">
        <div>
          <div class="title" id="resultTitle">–†–µ–∑—É–ª—å—Ç–∞—Ç</div>
          <div class="caption" id="resultCaption">–û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–∞, –ø—Ä–∏—á–∏–Ω—ã –∏ —á—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ</div>
        </div>
      </div>

      <div class="riskWrap">
        <div class="riskBar">
          <div class="barFill" id="barFill"></div>
        </div>
        <div class="riskScore">
          <span id="riskScore">0</span><span class="pct">%</span>
        </div>
        <div class="categoryTag" id="categoryTag">
          <div class="miniDot"></div>
          <span id="catText">‚Äî</span>
        </div>
      </div>

      <div class="block open depth-1" id="blkWhy">
        <div class="blockHead" data-acc="blkWhy">
          <h3 id="whyTitle">–ü–æ—á–µ–º—É —Ç–∞–∫</h3>
          <div class="chev">‚åÉ</div>
        </div>
        <div class="accWrap"><div class="accInner">
          <div id="reasons" style="color:var(--muted2)">‚Äî</div>
        </div></div>
      </div>

      <div class="block open depth-1" id="blkSafe">
        <div class="blockHead" data-acc="blkSafe">
          <h3 id="safeTitle">–ß—Ç–æ –¥–µ–ª–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ</h3>
          <div class="chev">‚åÉ</div>
        </div>
        <div class="accWrap"><div class="accInner">
          <div id="safe" style="color:var(--muted2)">‚Äî</div>
        </div></div>
      </div>

      <div class="block open depth-1" id="blkHL">
        <div class="blockHead" data-acc="blkHL">
          <h3 id="hlTitle">–ü–æ–¥—Å–≤–µ—Ç–∫–∞ –æ–ø–∞—Å–Ω—ã—Ö —Ñ—Ä–∞–∑</h3>
          <div class="chev">‚åÉ</div>
        </div>
        <div class="accWrap"><div class="accInner">
          <div id="highlight" class="hl">‚Äî</div>
        </div></div>
      </div>

    </div>
  </div>
</div>
<div id="loading" aria-hidden="true">
  <div class="loading-box">
    <div class="loading-top">
      <div>
        <div class="loading-title" id="loadingTitle">–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º‚Ä¶</div>
        <div class="loading-sub" id="loadingSub">–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∏ —Å–∫–∞–º–∞ –∏ —Ñ–∏—à–∏–Ω–≥–∞</div>
      </div>
      <div class="loading-pct"><span id="loadingPct">0</span>%</div>
    </div>

    <div class="loading-bar" aria-hidden="true">
      <div class="loading-fill" id="loadingFill"></div>
    </div>
  </div>
</div>

<div id="toast" role="status" aria-live="polite">
  <div class="t" id="toastTxt">‚Äî</div>
  <div class="x" id="toastClose" aria-label="Close">‚úï</div>
</div>

<script>
/* Cloudflare Worker endpoint (–í–ê–ñ–ù–û: /analyze, –∞ –Ω–µ –∫–æ—Ä–µ–Ω—å) */
const API_URL = "https://fraudguard-app.guideyeahofc.workers.dev/analyze";

const $ = id => document.getElementById(id);
const state = { lang: "ru" };

const I18N = {
  ru: {
    sub: "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —Å—Å—ã–ª–æ–∫ –Ω–∞ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ",
    pillAI: "AI-–∞–Ω–∞–ª–∏–∑",
    pillHotkeys: "–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏:",
    langLabel: "–Ø–∑—ã–∫",

    checkTitle: "–ü—Ä–æ–≤–µ—Ä–∫–∞",
    checkCaption: "–í—Å—Ç–∞–≤—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∏/–∏–ª–∏ —Å—Å—ã–ª–∫—É ‚Äî –ø–æ–ª—É—á–∏—à—å —Å–∫–æ—Ä, –ø—Ä–∏—á–∏–Ω—ã –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è",
    tabQuick: "–ë—ã—Å—Ç—Ä–æ",
    tabPro: "–ü–æ–¥—Ä–æ–±–Ω–æ",

    textLabel: "–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è",
    textPh: "–ù–∞–ø—Ä–∏–º–µ—Ä: –°–±–µ—Ä–±–∞–Ω–∫: –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –≤—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ...",

    urlLabel: "–°—Å—ã–ª–∫–∞ (–æ–ø—Ü.)",
    urlPh: "https://example.com/login",

    fromLabel: "–û—Ç –∫–æ–≥–æ –ø—Ä–∏—à–ª–æ (–æ–ø—Ü.)",
    fromPh: "Sberbank",

    btnCheck: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å",
    btnClear: "–û—á–∏—Å—Ç–∏—Ç—å",
    btnDemo: "–ü—Ä–∏–º–µ—Ä",

    note: "–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–≤–æ–¥–∏ –∫–æ–¥—ã –∏ –ø–∞—Ä–æ–ª–∏ –ø–æ —Å—Å—ã–ª–∫–∞–º –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π",

    resultTitle: "–†–µ–∑—É–ª—å—Ç–∞—Ç",
    resultCaption: "–û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–∞, –ø—Ä–∏—á–∏–Ω—ã –∏ —á—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ",

    whyTitle: "–ü–æ—á–µ–º—É —Ç–∞–∫",
    safeTitle: "–ß—Ç–æ –¥–µ–ª–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ",
    hlTitle: "–ü–æ–¥—Å–≤–µ—Ç–∫–∞ –æ–ø–∞—Å–Ω—ã—Ö —Ñ—Ä–∞–∑",

    toastExample: "–ü—Ä–∏–º–µ—Ä –≤—Å—Ç–∞–≤–ª–µ–Ω",
    toastCleared: "–û—á–∏—â–µ–Ω–æ",
    toastLinkExtracted: "–°—Å—ã–ª–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∞ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è",
    alertNeed: "–í—Å—Ç–∞–≤—å —Ç–µ–∫—Å—Ç –∏–ª–∏ —Å—Å—ã–ª–∫—É",

    loadingTitle: "–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º‚Ä¶",
    loadingSub: "–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∏ —Å–∫–∞–º–∞ –∏ —Ñ–∏—à–∏–Ω–≥–∞"
  },

  en: {
    sub: "Scam & phishing message checker",
    pillAI: "AI analysis",
    pillHotkeys: "Hotkeys:",
    langLabel: "Language",

    checkTitle: "Check",
    checkCaption: "Paste a message and/or link ‚Äî get score, reasons and safe actions",
    tabQuick: "Quick",
    tabPro: "Detailed",

    textLabel: "Message text",
    textPh: "For example: Sberbank: confirm login via link...",

    urlLabel: "Link (opt.)",
    urlPh: "https://example.com/login",

    fromLabel: "From (opt.)",
    fromPh: "Sberbank",

    btnCheck: "Check",
    btnClear: "Clear",
    btnDemo: "Example",

    note: "Never enter codes or passwords via links from messages",

    resultTitle: "Result",
    resultCaption: "Risk score, reasons and what to do next",

    whyTitle: "Why",
    safeTitle: "What to do safely",
    hlTitle: "Highlight risky phrases",

    toastExample: "Example inserted",
    toastCleared: "Cleared",
    toastLinkExtracted: "Link extracted from message",
    alertNeed: "Paste text or link",

    loadingTitle: "Analyzing‚Ä¶",
    loadingSub: "Checking scam & phishing signals"
  }
};

/* ===== I18N APPLY ===== */
function applyLang(lang){
  state.lang = lang;
  const t = I18N[lang];

  document.querySelector(".sub").textContent = t.sub;
  $("pillAI").textContent = t.pillAI;
  $("pillHotkeys").textContent = t.pillHotkeys;
  $("langLabel").textContent = t.langLabel;

  $("checkTitle").textContent = t.checkTitle;
  $("checkCaption").textContent = t.checkCaption;
  $("tabQuick").textContent = t.tabQuick;
  $("tabPro").textContent = t.tabPro;

  $("textLabel").textContent = t.textLabel;
  $("text").placeholder = t.textPh;

  $("urlLabel").textContent = t.urlLabel;
  $("url").placeholder = t.urlPh;

  $("fromLabel").textContent = t.fromLabel;
  $("from").placeholder = t.fromPh;

  $("btnCheckTxt").textContent = t.btnCheck;
  $("btnClearTxt").textContent = t.btnClear;
  $("btnDemoTxt").textContent = t.btnDemo;

  $("noteTxt").textContent = t.note;

  $("resultTitle").textContent = t.resultTitle;
  $("resultCaption").textContent = t.resultCaption;

  $("whyTitle").textContent = t.whyTitle;
  $("safeTitle").textContent = t.safeTitle;
  $("hlTitle").textContent = t.hlTitle;

  $("loadingTitle").textContent = t.loadingTitle;
  $("loadingSub").textContent = t.loadingSub;
}

/* ===== Tabs ===== */
const tabs = document.querySelectorAll(".tab");
const tabInd = $("tabInd");
const proWrap = $("proWrap");
const modeAnim = $("modeAnim");

function setMode(mode){
  tabs.forEach((t,i)=>{
    const active = t.dataset.mode === mode;
    t.classList.toggle("active", active);
    if(active){
      document.getElementById("tabs").style.setProperty("--i", i);
    }
  });

  if(mode === "pro"){
    proWrap.classList.add("show");
  }else{
    proWrap.classList.remove("show");
  }

  modeAnim.classList.remove("swap");
  void modeAnim.offsetWidth;
  modeAnim.classList.add("swap");
}

tabs.forEach(t=>{
  t.addEventListener("click", ()=> setMode(t.dataset.mode));
});

/* ===== Accordions ===== */
document.querySelectorAll(".blockHead").forEach(h=>{
  h.addEventListener("click", ()=>{
    const id = h.dataset.acc;
    const b = $(id);
    b.classList.toggle("open");

    const wrap = b.querySelector(".accWrap");
    const inner = b.querySelector(".accInner");

    if(b.classList.contains("open")){
      wrap.style.height = (inner.scrollHeight + 14) + "px";
    }else{
      wrap.style.height = "0px";
    }
  });
});

/* ===== Ripple ===== */
document.querySelectorAll(".btn").forEach(btn=>{
  btn.addEventListener("click", e=>{
    const r = document.createElement("span");
    r.className = "ripple";
    const rect = btn.getBoundingClientRect();
    const d = Math.max(rect.width, rect.height);
    r.style.width = r.style.height = d + "px";
    r.style.left = (e.clientX - rect.left - d/2) + "px";
    r.style.top = (e.clientY - rect.top - d/2) + "px";
    btn.appendChild(r);
    setTimeout(()=> r.remove(), 600);
  });
});

/* ===== Toast ===== */
let toastTimer = 0;
function showToast(text){
  const t = $("toast");
  $("toastTxt").textContent = text;
  t.classList.add("show");
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=> t.classList.remove("show"), 2600);
}
$("toastClose").onclick = ()=> $("toast").classList.remove("show");

/* ===== Risk color ===== */
function riskColor(v){
  if(v < 20) return "var(--good)";
  if(v < 50) return "var(--warn)";
  return "var(--bad)";
}

/* ===== Risk anim ===== */
const riskAnim = {
  v: 0,
  target: 0,
  color: "var(--good)",
  raf: 0,

  setColor(c){ this.color = c; },

  animateTo(v){
    this.target = v;
    if(!this.raf) this.tick();
  },

  reset(){
    this.v = 0;
    this.target = 0;
    $("riskScore").textContent = "0";
    $("barFill").style.width = "0%";
  },

  tick(){
    this.v += (this.target - this.v) * 0.14;
    const out = Math.round(this.v);
    $("riskScore").textContent = out;
    $("barFill").style.width = out + "%";
    $("barFill").style.background = this.color;

    if(Math.abs(this.target - this.v) > 0.2){
      this.raf = requestAnimationFrame(()=> this.tick());
    }else{
      this.v = this.target;
      this.raf = 0;
    }
  }
};

/* ===== Utils ===== */
function escapeHTML(s){
  return String(s||"")
    .replace(/&/g,"&amp;")
    .replace(/</g,"&lt;")
    .replace(/>/g,"&gt;");
}

/* ===== Scan highlight ===== */
function setScan(on){
  $("highlight").classList.toggle("scan", !!on);
}

function iconFor(reason){
  const s = (reason||"").toLowerCase();
  if(s.includes("–∫–æ–¥") || s.includes("–ø–∞—Ä–æ–ª") || s.includes("sms") || s.includes("—Å–º—Å")) return "üîë";
  if(s.includes("—Å—Å—ã–ª–∫–∞") || s.includes("–¥–æ–º–µ–Ω") || s.includes("url")) return "üîó";
  if(s.includes("—Å—Ä–æ—á") || s.includes("–Ω–µ–º–µ–¥") || s.includes("–≤ —Ç–µ—á–µ–Ω–∏–µ")) return "‚è±Ô∏è";
  if(s.includes("–ø–µ—Ä–µ–≤") || s.includes("–æ–ø–ª–∞—Ç") || s.includes("–¥–µ–Ω—å–≥")) return "üí∏";
  if(s.includes("–∏–Ω–≤–µ—Å—Ç") || s.includes("–¥–æ—Ö–æ–¥") || s.includes("–∫—Ä–∏–ø—Ç")) return "üìà";
  if(s.includes("—É–≥—Ä–æ–∑") || s.includes("—à–∞–Ω—Ç–∞–∂") || s.includes("–≤—ã–º–æ–≥")) return "üß®";
  return "‚ö†Ô∏è";
}

/* ===== Smart paste: extract URL from message ===== */
function extractFirstUrl(s){
  const m = String(s||"").match(/\bhttps?:\/\/[^\s<>"')]+/i);
  return m ? m[0] : "";
}
let urlToastLock = 0;
function smartExtractUrlFromText(){
  const text = $("text").value || "";
  const found = extractFirstUrl(text);
  if(found && !$("url").value.trim()){
    $("url").value = found;
    const now = Date.now();
    if(now - urlToastLock > 1400){
      urlToastLock = now;
      showToast(I18N[state.lang].toastLinkExtracted);
    }
  }
}

/* ===== char counter ===== */
function updateCharCount(){
  const n = ($("text").value || "").length;
  $("charCount").textContent = String(n);
}
$("text").addEventListener("input", ()=>{
  updateCharCount();
  smartExtractUrlFromText();
});
$("text").addEventListener("paste", ()=> setTimeout(()=>{
  updateCharCount();
  smartExtractUrlFromText();
}, 0));
updateCharCount();

/* ===== Loading bar driver ===== */
let loadRAF = 0;
let loadStart = 0;
let loadPct = 0;
function loadingStart(){
  $("loading").classList.add("show");
  $("loading").setAttribute("aria-hidden","false");
  loadStart = performance.now();
  loadPct = 0;
  $("loadingPct").textContent = "0";
  $("loadingFill").style.width = "0%";

  const tick = (t)=>{
    const dt = t - loadStart;
    const cap = 92;
    const next = cap * (1 - Math.exp(-dt / 900));
    loadPct = Math.max(loadPct, next);
    $("loadingPct").textContent = String(Math.round(loadPct));
    $("loadingFill").style.width = `${loadPct.toFixed(1)}%`;
    loadRAF = requestAnimationFrame(tick);
  };
  loadRAF = requestAnimationFrame(tick);
}

function loadingFinish(){
  cancelAnimationFrame(loadRAF);
  loadRAF = 0;

  $("loadingFill").style.width = "100%";
  $("loadingPct").textContent = "100";

  setTimeout(()=>{
    $("loading").classList.remove("show");
    $("loading").setAttribute("aria-hidden","true");
    setTimeout(()=>{
      $("loadingFill").style.width = "0%";
      $("loadingPct").textContent = "0";
    }, 250);
  }, 220);
}

/* ===== RENDER (AI -> UI) ===== */
function render(data){
  if(!data) return;

  $("emptyState") && ($("emptyState").style.display = "none");

  const scam = Number(data.scam_score ?? data.risk_score ?? 0);
  const danger = Number(data.danger_score ?? 0);
  const score = Math.max(0, Math.min(100, Math.round(Math.max(scam, danger))));
  const color = riskColor(score);

  riskAnim.setColor(color);
  riskAnim.animateTo(score);

  const cat = data.category || (score < 20 ? (state.lang==="ru"?"–Ω–∏–∑–∫–∏–π":"low") : score < 50 ? (state.lang==="ru"?"—Å—Ä–µ–¥–Ω–∏–π":"medium") : (state.lang==="ru"?"–≤—ã—Å–æ–∫–∏–π":"high"));
  $("catText").textContent = cat;
  $("categoryTag").querySelector(".miniDot").style.background = color;

  const reasons = Array.isArray(data.reasons) ? data.reasons : [];
  $("reasons").innerHTML = reasons.length
    ? `<div class="reasons-grid">${
        reasons.map(r=>`
          <div class="reason">
            <div class="ico">${iconFor(r)}</div>
            <div class="txt">
              ${escapeHTML(r)}
              <div class="sub">${state.lang==="ru" ? "–ü—Ä–æ–≤–µ—Ä—å —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫–∞–Ω–∞–ª (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ/—Å–∞–π—Ç –≤—Ä—É—á–Ω—É—é)" : "Verify via official channel (app/site manually)"}</div>
            </div>
          </div>`).join("")
      }</div>`
    : `<div style="color:var(--muted2)">‚Äî</div>`;

  const safe = Array.isArray(data.safe_actions) ? data.safe_actions : [];
  $("safe").innerHTML = safe.length
    ? `<ul>${safe.map(x=>`<li>${escapeHTML(x)}</li>`).join("")}</ul>`
    : `<div style="color:var(--muted2)">‚Äî</div>`;

  const text = $("text").value || "";
  const base = (state.lang==="ru")
    ? ["–∫–æ–¥","sms","—Å–º—Å","–ø–∞—Ä–æ–ª—å","cvv","cvc","–ø–µ—Ä–µ–≤–µ–¥–∏","–ø–µ—Ä–µ–≤–µ–¥–∏—Ç–µ","–æ–ø–ª–∞—Ç–∏","–æ–ø–ª–∞—Ç–∏—Ç–µ","—Å—Ä–æ—á–Ω–æ","–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ","–ø–æ–¥—Ç–≤–µ—Ä–¥","–≤–≤–µ–¥–∏—Ç–µ","–ª–æ–≥–∏–Ω","–∞–∫–∫–∞—É–Ω—Ç","–∫–∞—Ä—Ç–∞","–ø–∏–Ω","pin"]
    : ["code","sms","password","cvv","cvc","pay","transfer","urgent","immediately","verify","login","account","card","pin"];

  const fromReasons = reasons
    .join(" ")
    .split(/[\s,.;:!?()]+/g)
    .filter(w=>w && w.length>=4)
    .slice(0, 20);

  const badWords = Array.from(new Set([...base, ...fromReasons]));
  let out = escapeHTML(text);

  for(const w of badWords){
    const ww = String(w).replace(/[.*+?^${}()|[\]\\]/g,"\\$&");
    const re = new RegExp(ww, "gi");
    out = out.replace(re, m => `<mark>${escapeHTML(m)}</mark>`);
  }
  $("highlight").innerHTML = out || "‚Äî";

  ["blkWhy","blkSafe","blkHL"].forEach(id=>{
    const b = $(id);
    if(b && b.classList.contains("open")){
      const wrap = b.querySelector(".accWrap");
      const inner = b.querySelector(".accInner");
      if(wrap && inner) wrap.style.height = (inner.scrollHeight + 14) + "px";
    }
  });
}

/* ===== API call ===== */
async function runAiCheck(){
  const url = $("url").value.trim();
  const from = $("from") ? $("from").value.trim() : "";
  const text = $("text").value.trim();

  if(!text && !url){
    alert(I18N[state.lang].alertNeed);
    return;
  }

  loadingStart();
  setScan(true);
  $("btnCheck").disabled = true;

  try{
    let r;
    try{
      r = await fetchWithTimeout(API_URL, {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({url,from,text})
      }, 9000);
    }catch(e){
      r = await fetchWithTimeout(API_URL, {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({url,from,text})
      }, 9000);
    }

    const raw = await r.text();
    let data;
    try { data = JSON.parse(raw); }
    catch { throw new Error((state.lang==="ru"?"–§—É–Ω–∫—Ü–∏—è –≤–µ—Ä–Ω—É–ª–∞ –Ω–µ-JSON: ":"Non-JSON response: ") + raw.slice(0,160)); }

    if(!r.ok || data?.error){
      throw new Error(data?.error || (state.lang==="ru"?"–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞":"Request error"));
    }

    render(data);
  }catch(err){
    alert(err.message || err);
  }finally{
    setScan(false);
    loadingFinish();
    $("btnCheck").disabled = false;
  }
}

/* ===== Helpers ===== */
function fetchWithTimeout(resource, options={}, timeout=8000){
  return Promise.race([
    fetch(resource, options),
    new Promise((_, reject)=> setTimeout(()=> reject(new Error("timeout")), timeout))
  ]);
}

/* ===== DEMO DATA ===== */
const DEMOS = [
  {
    text: "–°–±–µ—Ä–±–∞–Ω–∫: –í–∞—à–∞ –∫–∞—Ä—Ç–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞. –°—Ä–æ—á–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–æ —Å—Å—ã–ª–∫–µ: https://sber-secure-login.com",
    url: "https://sber-secure-login.com",
    from: "Sberbank"
  },
  {
    text: "–ü–æ—Å—ã–ª–∫–∞ –æ–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã –¥–æ—Å—Ç–∞–≤–∫–∏. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: http://post-pay-delivery.ru",
    url: "http://post-pay-delivery.ru",
    from: "Delivery Service"
  },
  {
    text: "–ò–Ω–≤–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—É –∏ –ø–æ–ª—É—á–∏—Ç–µ –¥–æ—Ö–æ–¥ 300% –∑–∞ –Ω–µ–¥–µ–ª—é. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: https://crypto-profit-now.io",
    url: "https://crypto-profit-now.io",
    from: "Crypto Invest"
  },
  {
    text: "–ú—ã –Ω–∞—à–ª–∏ –≤–∞—à—É –∞–Ω–∫–µ—Ç—É –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —Ä–∞–±–æ—Ç—É —Å –¥–æ—Ö–æ–¥–æ–º –æ—Ç 5000‚ÇΩ –≤ –¥–µ–Ω—å. –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏: https://job-offer-fast.ru",
    url: "https://job-offer-fast.ru",
    from: "HR"
  }
];
let demoIdx = 0;

/* Buttons */
$("btnCheck").onclick = runAiCheckAndScroll;

$("btnClear").onclick = ()=>{
  demoType.cancel();

  $("url").value="";
  if($("from")) $("from").value="";
  $("text").value="";
  updateCharCount();

  $("emptyState") && ($("emptyState").style.display = "grid");
  $("highlight").textContent="‚Äî";
  $("reasons").textContent="‚Äî";
  $("safe").textContent="‚Äî";

  riskAnim.reset();

  $("catText").textContent="‚Äî";
  $("categoryTag").querySelector(".miniDot").style.background = "rgba(255,255,255,35)";
  $("barFill").style.width="0%";

  showToast(I18N[state.lang].toastCleared);
};

$("btnDemo").onclick = async ()=>{
  if(demoType.isRunning()){
    demoType.finishInstant();
    showToast(I18N[state.lang].toastExample);
    return;
  }
  const ex = DEMOS[demoIdx % DEMOS.length];
  demoIdx++;
  await demoType.run(ex);
  showToast(I18N[state.lang].toastExample);
};

/* Language init */
(function initLang(){
  const sel = $("lang");
  const saved = localStorage.getItem("fg_lang");
  const start = (saved === "en" || saved === "ru") ? saved : "ru";
  applyLang(start);
  if(sel){
    sel.value = start;
    sel.addEventListener("change", ()=>{
      const v = sel.value === "en" ? "en" : "ru";
      localStorage.setItem("fg_lang", v);
      applyLang(v);
    });
  }
})();
/* ===== DEMO TYPE ANIMATION ===== */
const demoType = (function(){
  let raf = 0;
  let running = false;
  let queue = [];
  let idx = 0;
  let target = null;
  let fields = [];
  let finishNow = false;

  function isRunning(){ return running; }

  function cancel(){
    cancelAnimationFrame(raf);
    raf = 0;
    running = false;
    finishNow = false;
    queue = [];
    idx = 0;
    target = null;
    fields = [];
  }

  function finishInstant(){
    if(!running || !queue.length) return;
    finishNow = true;
  }

  async function run(data){
    cancel();
    running = true;
    finishNow = false;

    const order = [
      {el: $("text"), key:"text"},
      {el: $("url"), key:"url"},
      {el: $("from"), key:"from"}
    ];

    fields = order.filter(o=>o.el);

    queue = [];
    for(const f of fields){
      const val = data[f.key] || "";
      queue.push({el:f.el, val});
    }

    idx = 0;
    await nextField();
    running = false;
  }

  async function nextField(){
    if(idx >= queue.length) return;
    const item = queue[idx++];
    target = item.el;
    const text = String(item.val);
    target.value = "";
    updateCharCount();

    let i = 0;
    const speed = 18 + Math.random()*22;

    return new Promise(resolve=>{
      const tick = ()=>{
        if(finishNow){
          target.value = text;
          updateCharCount();
          resolve();
          return;
        }

        i += Math.max(1, Math.round(speed * 0.16));
        target.value = text.slice(0, i);
        updateCharCount();

        if(i < text.length){
          raf = requestAnimationFrame(tick);
        }else{
          resolve();
        }
      };
      raf = requestAnimationFrame(tick);
    }).then(()=> nextField());
  }

  return { run, cancel, finishInstant, isRunning };
})();

/* ===== HOTKEYS ===== */
document.addEventListener("keydown", e=>{
  if(e.ctrlKey && e.key === "Enter"){
    runAiCheckAndScroll();
  }
});

/* ===== AUTO SCROLL TO RESULT (DESKTOP ONLY) ===== */
function runAiCheckAndScroll(){
  const isMobile = matchMedia("(pointer: coarse)").matches;

  runAiCheck();

  if(!isMobile){
    setTimeout(()=>{
      const r = document.getElementById("rightCard");
      if(r){
        r.scrollIntoView({behavior:"smooth", block:"center"});
      }
    }, 420);
  }
}

/* ===== 3D TILT ===== */
function tiltBind(el){
  if(!el) return;

  const MAX_X = 10;
  const MAX_Y = 12;
  const EDGE = 12;
  const SMOOTH = 0.14;

  let rect = null;
  let raf = 0;
  let mx = 0, my = 0;
  let active = false;
  let curRX = 0, curRY = 0;
  let tgtRX = 0, tgtRY = 0;

  function measure(){ rect = el.getBoundingClientRect(); }

  function renderTilt(){
    raf = 0;
    curRX += (tgtRX - curRX) * SMOOTH;
    curRY += (tgtRY - curRY) * SMOOTH;

    el.style.transform =
      `perspective(980px) rotateX(${curRX.toFixed(2)}deg) rotateY(${curRY.toFixed(2)}deg)`;

    if(active && rect){
      const px = Math.max(0, Math.min(1, (mx - rect.left) / rect.width));
      const py = Math.max(0, Math.min(1, (my - rect.top) / rect.height));
      el.style.setProperty("--mx", (px * 100).toFixed(2) + "%");
      el.style.setProperty("--my", (py * 100).toFixed(2) + "%");
    }

    if(Math.abs(curRX)>0.05 || Math.abs(curRY)>0.05){
      raf = requestAnimationFrame(renderTilt);
    }
  }

  el.addEventListener("pointerenter", e=>{
    active = true;
    measure();
    mx = e.clientX;
    my = e.clientY;
    raf || (raf = requestAnimationFrame(renderTilt));
  });

  el.addEventListener("pointermove", e=>{
    if(!active) return;
    mx = e.clientX;
    my = e.clientY;

    const x = mx - rect.left;
    const y = my - rect.top;

    const px = Math.max(0, Math.min(1, x / rect.width));
    const py = Math.max(0, Math.min(1, y / rect.height));

    tgtRX = (0.5 - py) * MAX_X;
    tgtRY = (px - 0.5) * MAX_Y;
  });

  el.addEventListener("pointerleave", ()=>{
    active = false;
    tgtRX = 0;
    tgtRY = 0;
    raf || (raf = requestAnimationFrame(renderTilt));
  });
}

tiltBind(document.getElementById("leftCard"));
tiltBind(document.getElementById("rightCard"));

/* ===== MOBILE PERF PATCH: disable tilt on touch ===== */
const IS_TOUCH = matchMedia("(pointer: coarse)").matches;

const _tiltBind = tiltBind;
tiltBind = function(el){
  if(IS_TOUCH) return;
  _tiltBind(el);
};

/* ===== UI LOAD PATCH ===== */
window.addEventListener("DOMContentLoaded", ()=>{
  document.body.classList.add("ui-ready");
});

</script>
</body>
</html>
